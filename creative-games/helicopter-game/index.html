<!DOCTYPE html>
<html>
<head>
    <title>í—¬ë¦¬ì½¥í„° ê²Œì„</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            color: #333;
            text-align: center;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            animation: fly 3s ease-in-out infinite;
        }
        
        @keyframes fly {
            0%, 100% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
        }
        
        .game-container {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }
        
        canvas {
            border: 5px solid #2c3e50;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 100%);
            cursor: pointer;
            outline: none;
        }
        
        canvas:focus {
            border-color: #3498db;
        }
        
        .game-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.9);
            border: 3px solid #2c3e50;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 600px;
            color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .altitude-meter {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 30px;
            height: 200px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #3498db;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .altitude-fill {
            width: 100%;
            background: linear-gradient(0deg, #e74c3c, #f39c12, #2ecc71);
            border-radius: 13px;
            transition: height 0.1s;
        }
        
        .fuel-meter {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 30px;
            height: 200px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #f39c12;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .fuel-fill {
            width: 100%;
            background: linear-gradient(0deg, #e74c3c, #f39c12, #2ecc71);
            border-radius: 13px;
            transition: height 0.1s;
        }
        
        .wind-indicator {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 15px;
            border: 2px solid #95a5a6;
            font-weight: bold;
        }
        
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 100;
            border: 3px solid #e74c3c;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .difficulty-selector {
            margin: 20px 0;
        }
        
        .difficulty-btn {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: 2px solid transparent;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        
        .difficulty-btn.active {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.2);
        }
        
        .difficulty-btn:hover {
            background: rgba(255, 255, 255, 1);
        }
    </style>
</head>
<body>
    <h1>ğŸš í—¬ë¦¬ì½¥í„° ê²Œì„</h1>
    
    <div class="instructions">
        <p><strong>ğŸ® ì¡°ì‘ë²•:</strong> ìŠ¤í˜ì´ìŠ¤ë°”ë‚˜ ë§ˆìš°ìŠ¤ í´ë¦­ìœ¼ë¡œ í—¬ë¦¬ì½¥í„°ë¥¼ ìœ„ë¡œ ì˜¬ë¦¬ì„¸ìš”!</p>
        <p><strong>ğŸ¯ ëª©í‘œ:</strong> ì¥ì• ë¬¼ì„ í”¼í•˜ë©´ì„œ ìµœëŒ€í•œ ë©€ë¦¬ ë‚ ì•„ê°€ì„¸ìš”!</p>
        <p><strong>âš ï¸ ì£¼ì˜:</strong> ì—°ë£Œê°€ ë–¨ì–´ì§€ê±°ë‚˜ ì¥ì• ë¬¼ì— ë¶€ë”ªíˆë©´ ê²Œì„ ì˜¤ë²„!</p>
    </div>
    
    <div class="difficulty-selector">
        <button class="difficulty-btn active" onclick="setDifficulty('easy')">ì‰¬ì›€</button>
        <button class="difficulty-btn" onclick="setDifficulty('medium')">ë³´í†µ</button>
        <button class="difficulty-btn" onclick="setDifficulty('hard')">ì–´ë ¤ì›€</button>
    </div>
    
    <div class="game-info">
        <div class="info-box">ê±°ë¦¬: <span id="distance">0</span>m</div>
        <div class="info-box">ì ìˆ˜: <span id="score">0</span></div>
        <div class="info-box">ìµœê³  ê¸°ë¡: <span id="bestScore">0</span></div>
    </div>
    
    <div class="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="altitude-meter">
            <div class="altitude-fill" id="altitudeFill" style="height: 50%;"></div>
        </div>
        
        <div class="fuel-meter">
            <div class="fuel-fill" id="fuelFill" style="height: 100%;"></div>
        </div>
        
        <div class="wind-indicator" id="windIndicator">
            ğŸ’¨ ë°”ëŒ: ì—†ìŒ
        </div>
        
        <div class="game-over" id="gameOver">
            <h2 style="color: #e74c3c;">ğŸš ì¶”ë½!</h2>
            <p>ìµœì¢… ê±°ë¦¬: <span id="finalDistance">0</span>m</p>
            <p>ìµœì¢… ì ìˆ˜: <span id="finalScore">0</span></p>
            <p id="crashReason">ì¥ì• ë¬¼ì— ì¶©ëŒí–ˆìŠµë‹ˆë‹¤!</p>
            <button onclick="resetGame()">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>
    
    <div class="controls">
        <button onclick="startGame()">ê²Œì„ ì‹œì‘</button>
        <button onclick="pauseGame()">ì¼ì‹œì •ì§€</button>
        <button onclick="resetGame()">ë‹¤ì‹œ ì‹œì‘</button>
        <p style="margin-top: 15px; color: #666;">
            ğŸ’¡ íŒ: ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ì§§ê²Œ ëˆŒëŸ¬ì„œ ë¶€ë“œëŸ½ê²Œ ì¡°ì¢…í•˜ì„¸ìš”!<br>
            ğŸ–±ï¸ ë§ˆìš°ìŠ¤ í´ë¦­ì´ë‚˜ ìº”ë²„ìŠ¤ í„°ì¹˜ë¡œë„ ì¡°ì¢… ê°€ëŠ¥í•©ë‹ˆë‹¤!<br>
            ğŸ® ë¨¼ì € "ê²Œì„ ì‹œì‘" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!
        </p>
    </div>
    
    <script>
        // ìº”ë²„ìŠ¤ ì„¤ì •
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ê²Œì„ ìƒíƒœ
        let gameRunning = false;
        let gamePaused = false;
        let distance = 0;
        let score = 0;
        let bestScore = localStorage.getItem('helicopterBestScore') || 0;
        let difficulty = 'easy';

        // í—¬ë¦¬ì½¥í„° ì„¤ì •
        const helicopter = {
            x: 100,
            y: canvas.height / 2,
            width: 60,
            height: 30,
            velocityY: 0,
            thrust: -0.8,
            gravity: 0.4,
            fuel: 100,
            maxFuel: 100,
            fuelConsumption: 0.1,
            rotorAngle: 0,
            trail: []
        };

        // ê²Œì„ ì„¤ì •
        let gameSpeed = 2;
        let obstacleSpawnRate = 0.02;
        let windForce = 0;
        let windDirection = 0;
        let windChangeTimer = 0;

        // ë‚œì´ë„ë³„ ì„¤ì •
        const difficultySettings = {
            easy: { speed: 2, spawnRate: 0.015, fuelConsumption: 0.08 },
            medium: { speed: 3, spawnRate: 0.025, fuelConsumption: 0.12 },
            hard: { speed: 4, spawnRate: 0.035, fuelConsumption: 0.15 }
        };

        // ê²Œì„ ê°ì²´ë“¤
        let obstacles = [];
        let particles = [];
        let clouds = [];
        let fuelPickups = [];

        // ì¥ì• ë¬¼ í´ë˜ìŠ¤
        class Obstacle {
            constructor(type, x, y, width, height) {
                this.type = type;
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.speed = gameSpeed;
            }
            
            update() {
                this.x -= this.speed;
            }
            
            draw() {
                ctx.save();
                
                if (this.type === 'building') {
                    // ë¹Œë”©
                    ctx.fillStyle = '#34495e';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                    
                    // ë¹Œë”© ì°½ë¬¸
                    ctx.fillStyle = '#f39c12';
                    for (let i = 0; i < this.width; i += 20) {
                        for (let j = 0; j < this.height; j += 25) {
                            if (Math.random() < 0.7) {
                                ctx.fillRect(this.x + i + 5, this.y + j + 5, 10, 15);
                            }
                        }
                    }
                } else if (this.type === 'mountain') {
                    // ì‚°
                    ctx.fillStyle = '#27ae60';
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y + this.height);
                    ctx.lineTo(this.x + this.width/2, this.y);
                    ctx.lineTo(this.x + this.width, this.y + this.height);
                    ctx.closePath();
                    ctx.fill();
                    
                    // ì‚° ì •ìƒ (ëˆˆ)
                    ctx.fillStyle = '#ecf0f1';
                    ctx.beginPath();
                    ctx.moveTo(this.x + this.width/2 - 15, this.y + 20);
                    ctx.lineTo(this.x + this.width/2, this.y);
                    ctx.lineTo(this.x + this.width/2 + 15, this.y + 20);
                    ctx.closePath();
                    ctx.fill();
                } else if (this.type === 'bird') {
                    // ìƒˆ
                    ctx.fillStyle = '#2c3e50';
                    ctx.font = '20px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('ğŸ¦', this.x + this.width/2, this.y + this.height/2 + 7);
                } else if (this.type === 'balloon') {
                    // í’ì„ 
                    ctx.fillStyle = '#e74c3c';
                    ctx.beginPath();
                    ctx.arc(this.x + this.width/2, this.y + 15, 15, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // í’ì„  ì¤„
                    ctx.strokeStyle = '#2c3e50';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(this.x + this.width/2, this.y + 30);
                    ctx.lineTo(this.x + this.width/2, this.y + this.height);
                    ctx.stroke();
                }
                
                ctx.restore();
            }
            
            checkCollision(heli) {
                return heli.x < this.x + this.width &&
                       heli.x + heli.width > this.x &&
                       heli.y < this.y + this.height &&
                       heli.y + heli.height > this.y;
            }
            
            isOffScreen() {
                return this.x + this.width < 0;
            }
        }

        // ì—°ë£Œ í”½ì—… í´ë˜ìŠ¤
        class FuelPickup {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 30;
                this.height = 30;
                this.speed = gameSpeed;
                this.pulse = 0;
            }
            
            update() {
                this.x -= this.speed;
                this.pulse += 0.2;
            }
            
            draw() {
                const pulseSize = Math.sin(this.pulse) * 3;
                
                ctx.save();
                ctx.translate(this.x + this.width/2, this.y + this.height/2);
                
                // ì—°ë£Œí†µ
                ctx.fillStyle = '#f39c12';
                ctx.fillRect(-12 - pulseSize/2, -12 - pulseSize/2, 24 + pulseSize, 24 + pulseSize);
                
                // ì—°ë£Œ í‘œì‹œ
                ctx.fillStyle = '#2c3e50';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('â›½', 0, 5);
                
                ctx.restore();
            }
            
            checkCollision(heli) {
                return heli.x < this.x + this.width &&
                       heli.x + heli.width > this.x &&
                       heli.y < this.y + this.height &&
                       heli.y + heli.height > this.y;
            }
            
            isOffScreen() {
                return this.x + this.width < 0;
            }
        }

        // êµ¬ë¦„ í´ë˜ìŠ¤
        class Cloud {
            constructor(x, y, size) {
                this.x = x;
                this.y = y;
                this.size = size;
                this.speed = gameSpeed * 0.3;
                this.opacity = Math.random() * 0.5 + 0.3;
            }
            
            update() {
                this.x -= this.speed;
            }
            
            draw() {
                ctx.save();
                ctx.globalAlpha = this.opacity;
                ctx.fillStyle = '#ffffff';
                
                // êµ¬ë¦„ ê·¸ë¦¬ê¸°
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * 0.5, 0, Math.PI * 2);
                ctx.arc(this.x + this.size * 0.3, this.y, this.size * 0.7, 0, Math.PI * 2);
                ctx.arc(this.x + this.size * 0.6, this.y, this.size * 0.5, 0, Math.PI * 2);
                ctx.arc(this.x - this.size * 0.3, this.y, this.size * 0.6, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }
            
            isOffScreen() {
                return this.x + this.size < 0;
            }
        }

        // íŒŒí‹°í´ í´ë˜ìŠ¤
        class Particle {
            constructor(x, y, color, type = 'normal') {
                this.x = x;
                this.y = y;
                this.dx = (Math.random() - 0.5) * 6;
                this.dy = (Math.random() - 0.5) * 6;
                this.color = color;
                this.life = 30;
                this.maxLife = 30;
                this.size = Math.random() * 4 + 2;
                this.type = type;
            }
            
            update() {
                this.x += this.dx;
                this.y += this.dy;
                this.life--;
                
                if (this.type === 'exhaust') {
                    this.dy += 0.1; // ë°°ê¸°ê°€ìŠ¤ëŠ” ìœ„ë¡œ ì˜¬ë¼ê°
                    this.dx -= 0.2; // ë’¤ë¡œ ë°€ë¦¼
                } else {
                    this.dy += 0.2; // ì¤‘ë ¥
                }
                
                this.dx *= 0.98; // ê³µê¸° ì €í•­
            }
            
            draw() {
                const alpha = this.life / this.maxLife;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = this.color;
                
                if (this.type === 'exhaust') {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    ctx.fillRect(this.x, this.y, this.size, this.size);
                }
                
                ctx.globalAlpha = 1;
            }
            
            isDead() {
                return this.life <= 0;
            }
        }

        // ë°°ê²½ ê·¸ë¦¬ê¸°
        function drawBackground() {
            // í•˜ëŠ˜ ê·¸ë¼ë°ì´ì…˜
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#98FB98');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // êµ¬ë¦„ë“¤ ê·¸ë¦¬ê¸°
            clouds.forEach(cloud => cloud.draw());
            
            // ì§€í‰ì„ 
            ctx.fillStyle = '#27ae60';
            ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
        }

        // í—¬ë¦¬ì½¥í„° ê·¸ë¦¬ê¸°
        function drawHelicopter() {
            ctx.save();
            ctx.translate(helicopter.x + helicopter.width/2, helicopter.y + helicopter.height/2);
            
            // í—¬ë¦¬ì½¥í„° ê¶¤ì 
            if (helicopter.trail.length > 1) {
                ctx.strokeStyle = 'rgba(52, 152, 219, 0.3)';
                ctx.lineWidth = 3;
                ctx.beginPath();
                for (let i = 0; i < helicopter.trail.length; i++) {
                    const point = helicopter.trail[i];
                    if (i === 0) {
                        ctx.moveTo(point.x - helicopter.x, point.y - helicopter.y);
                    } else {
                        ctx.lineTo(point.x - helicopter.x, point.y - helicopter.y);
                    }
                }
                ctx.stroke();
            }
            
            // í—¬ë¦¬ì½¥í„° ëª¸ì²´
            ctx.fillStyle = '#3498db';
            ctx.fillRect(-helicopter.width/2, -helicopter.height/2, helicopter.width, helicopter.height);
            
            // í—¬ë¦¬ì½¥í„° ì¡°ì¢…ì„
            ctx.fillStyle = '#2980b9';
            ctx.fillRect(-helicopter.width/2 + 10, -helicopter.height/2 + 5, 25, 20);
            
            // í—¬ë¦¬ì½¥í„° ì°½ë¬¸
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(-helicopter.width/2 + 12, -helicopter.height/2 + 7, 21, 16);
            
            // ë©”ì¸ ë¡œí„°
            ctx.save();
            ctx.translate(0, -helicopter.height/2 - 10);
            ctx.rotate(helicopter.rotorAngle);
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(-40, 0);
            ctx.lineTo(40, 0);
            ctx.stroke();
            ctx.restore();
            
            // ê¼¬ë¦¬ ë¡œí„°
            ctx.save();
            ctx.translate(helicopter.width/2 + 5, 0);
            ctx.rotate(helicopter.rotorAngle * 3);
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(-8, 0);
            ctx.lineTo(8, 0);
            ctx.moveTo(0, -8);
            ctx.lineTo(0, 8);
            ctx.stroke();
            ctx.restore();
            
            // ì°©ë¥™ ì¥ì¹˜
            ctx.fillStyle = '#34495e';
            ctx.fillRect(-helicopter.width/2 + 5, helicopter.height/2, 50, 3);
            
            ctx.restore();
        }

        // ì¥ì• ë¬¼ ìƒì„±
        function generateObstacles() {
            if (Math.random() < obstacleSpawnRate) {
                const types = ['building', 'mountain', 'bird', 'balloon'];
                const type = types[Math.floor(Math.random() * types.length)];
                
                let obstacle;
                const x = canvas.width + 50;
                
                if (type === 'building') {
                    const height = Math.random() * 200 + 100;
                    const y = canvas.height - 50 - height;
                    obstacle = new Obstacle(type, x, y, 60, height);
                } else if (type === 'mountain') {
                    const height = Math.random() * 150 + 150;
                    const y = canvas.height - 50 - height;
                    obstacle = new Obstacle(type, x, y, 100, height);
                } else if (type === 'bird') {
                    const y = Math.random() * (canvas.height - 200) + 50;
                    obstacle = new Obstacle(type, x, y, 30, 30);
                } else if (type === 'balloon') {
                    const y = Math.random() * (canvas.height - 300) + 50;
                    obstacle = new Obstacle(type, x, y, 30, 80);
                }
                
                obstacles.push(obstacle);
            }
        }

        // ì—°ë£Œ í”½ì—… ìƒì„±
        function generateFuelPickups() {
            if (Math.random() < 0.005 && helicopter.fuel < 50) {
                const x = canvas.width + 50;
                const y = Math.random() * (canvas.height - 200) + 50;
                fuelPickups.push(new FuelPickup(x, y));
            }
        }

        // êµ¬ë¦„ ìƒì„±
        function generateClouds() {
            if (Math.random() < 0.01) {
                const x = canvas.width + 100;
                const y = Math.random() * (canvas.height - 200) + 50;
                const size = Math.random() * 50 + 30;
                clouds.push(new Cloud(x, y, size));
            }
        }

        // ë°”ëŒ ì—…ë°ì´íŠ¸
        function updateWind() {
            windChangeTimer++;
            
            if (windChangeTimer > 300) { // 5ì´ˆë§ˆë‹¤ ë°”ëŒ ë³€ê²½
                windDirection = (Math.random() - 0.5) * 2; // -1 ~ 1
                windForce = Math.random() * 0.3;
                windChangeTimer = 0;
            }
            
            // ë°”ëŒ í‘œì‹œ ì—…ë°ì´íŠ¸
            let windText = 'ğŸ’¨ ë°”ëŒ: ';
            if (Math.abs(windForce) < 0.1) {
                windText += 'ì—†ìŒ';
            } else if (windDirection > 0) {
                windText += `ì˜¤ë¥¸ìª½ ${windForce.toFixed(1)}`;
            } else {
                windText += `ì™¼ìª½ ${Math.abs(windForce).toFixed(1)}`;
            }
            
            document.getElementById('windIndicator').textContent = windText;
        }

        // í—¬ë¦¬ì½¥í„° ì—…ë°ì´íŠ¸
        function updateHelicopter() {
            // ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìœ¼ë©´ í—¬ë¦¬ì½¥í„°ë¥¼ ë–¨ì–´ëœ¨ë¦¬ì§€ ì•ŠìŒ
            if (!gameRunning) return;
            
            // ë¡œí„° íšŒì „
            helicopter.rotorAngle += 0.5;
            
            // ì¤‘ë ¥ ì ìš©
            helicopter.velocityY += helicopter.gravity;
            
            // ë°”ëŒ ì˜í–¥
            helicopter.x += windDirection * windForce;
            
            // ìœ„ì¹˜ ì—…ë°ì´íŠ¸
            helicopter.y += helicopter.velocityY;
            
            // ì—°ë£Œ ì†Œëª¨
            helicopter.fuel -= helicopter.fuelConsumption;
            
            // ê¶¤ì  ì—…ë°ì´íŠ¸
            helicopter.trail.push({ x: helicopter.x + helicopter.width/2, y: helicopter.y + helicopter.height/2 });
            if (helicopter.trail.length > 20) {
                helicopter.trail.shift();
            }
            
            // ë°°ê¸°ê°€ìŠ¤ íŒŒí‹°í´
            if (Math.random() < 0.3) {
                particles.push(new Particle(
                    helicopter.x - 10,
                    helicopter.y + helicopter.height/2,
                    'rgba(100, 100, 100, 0.6)',
                    'exhaust'
                ));
            }
            
            // ê²½ê³„ í™•ì¸
            if (helicopter.y < 0) {
                helicopter.y = 0;
                helicopter.velocityY = 0;
            }
            if (helicopter.y > canvas.height - 50 - helicopter.height) {
                gameOver('ì§€ë©´ì— ì¶©ëŒí–ˆìŠµë‹ˆë‹¤!');
            }
            if (helicopter.x < 0) {
                helicopter.x = 0;
            }
            if (helicopter.x > canvas.width - helicopter.width) {
                helicopter.x = canvas.width - helicopter.width;
            }
            
            // ì—°ë£Œ ë¶€ì¡±
            if (helicopter.fuel <= 0) {
                gameOver('ì—°ë£Œê°€ ë–¨ì–´ì¡ŒìŠµë‹ˆë‹¤!');
            }
        }

        // ê²Œì„ ì—…ë°ì´íŠ¸
        function update() {
            if (!gameRunning || gamePaused) return;
            
            updateHelicopter();
            updateWind();
            
            // ê±°ë¦¬ ë° ì ìˆ˜ ì—…ë°ì´íŠ¸
            distance += gameSpeed * 0.1;
            score += Math.floor(gameSpeed);
            
            // ë‚œì´ë„ ì¦ê°€
            if (distance > 100) {
                gameSpeed = Math.min(6, difficultySettings[difficulty].speed + distance * 0.01);
                obstacleSpawnRate = Math.min(0.05, difficultySettings[difficulty].spawnRate + distance * 0.0001);
            }
            
            // ê°ì²´ ìƒì„±
            generateObstacles();
            generateFuelPickups();
            generateClouds();
            
            // ê°ì²´ ì—…ë°ì´íŠ¸
            obstacles.forEach(obstacle => obstacle.update());
            fuelPickups.forEach(pickup => pickup.update());
            clouds.forEach(cloud => cloud.update());
            particles.forEach(particle => particle.update());
            
            // ì¶©ëŒ ê²€ì‚¬
            for (let obstacle of obstacles) {
                if (obstacle.checkCollision(helicopter)) {
                    gameOver('ì¥ì• ë¬¼ì— ì¶©ëŒí–ˆìŠµë‹ˆë‹¤!');
                    return;
                }
            }
            
            // ì—°ë£Œ í”½ì—… ê²€ì‚¬
            for (let i = fuelPickups.length - 1; i >= 0; i--) {
                const pickup = fuelPickups[i];
                if (pickup.checkCollision(helicopter)) {
                    helicopter.fuel = Math.min(helicopter.maxFuel, helicopter.fuel + 30);
                    score += 50;
                    
                    // ì—°ë£Œ íšë“ íŒŒí‹°í´
                    for (let j = 0; j < 10; j++) {
                        particles.push(new Particle(pickup.x, pickup.y, '#f39c12'));
                    }
                    
                    fuelPickups.splice(i, 1);
                }
            }
            
            // í™”ë©´ ë°– ê°ì²´ ì œê±°
            obstacles = obstacles.filter(obstacle => !obstacle.isOffScreen());
            fuelPickups = fuelPickups.filter(pickup => !pickup.isOffScreen());
            clouds = clouds.filter(cloud => !cloud.isOffScreen());
            particles = particles.filter(particle => !particle.isDead());
            
            updateDisplay();
        }

        // ê²Œì„ ê·¸ë¦¬ê¸°
        function draw() {
            drawBackground();
            
            // ê²Œì„ ê°ì²´ë“¤ ê·¸ë¦¬ê¸°
            obstacles.forEach(obstacle => obstacle.draw());
            fuelPickups.forEach(pickup => pickup.draw());
            drawHelicopter();
            particles.forEach(particle => particle.draw());
        }

        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            if (!gameRunning) return;
            
            update();
            draw();
            
            requestAnimationFrame(gameLoop);
        }

        // ì´ˆê¸° ê·¸ë¦¬ê¸° í•¨ìˆ˜ (ê²Œì„ ì‹œì‘ ì „ì—ë„ í—¬ë¦¬ì½¥í„°ë¥¼ ë³´ì—¬ì¤Œ)
        function initialDraw() {
            if (!gameRunning) {
                drawBackground();
                drawHelicopter();
                requestAnimationFrame(initialDraw);
            }
        }

        // í—¬ë¦¬ì½¥í„° ìƒìŠ¹
        function liftHelicopter() {
            if (gameRunning && !gamePaused && helicopter.fuel > 0) {
                helicopter.velocityY += helicopter.thrust;
                helicopter.fuel -= helicopter.fuelConsumption * 2; // ìƒìŠ¹ ì‹œ ì—°ë£Œ ë” ì†Œëª¨
                
                // ì¶”ì§„ íŒŒí‹°í´
                for (let i = 0; i < 3; i++) {
                    particles.push(new Particle(
                        helicopter.x + helicopter.width/2,
                        helicopter.y + helicopter.height,
                        'rgba(255, 100, 0, 0.8)',
                        'exhaust'
                    ));
                }
            }
        }

        // ê²Œì„ ì˜¤ë²„
        function gameOver(reason) {
            gameRunning = false;
            
            // ìµœê³  ê¸°ë¡ ì—…ë°ì´íŠ¸
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem('helicopterBestScore', bestScore);
            }
            
            document.getElementById('finalDistance').textContent = Math.floor(distance);
            document.getElementById('finalScore').textContent = score;
            document.getElementById('crashReason').textContent = reason;
            document.getElementById('gameOver').style.display = 'block';
            
            // í­ë°œ íŒŒí‹°í´
            for (let i = 0; i < 20; i++) {
                particles.push(new Particle(
                    helicopter.x + helicopter.width/2,
                    helicopter.y + helicopter.height/2,
                    '#ff6b6b'
                ));
            }
        }

        // ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            document.getElementById('distance').textContent = Math.floor(distance);
            document.getElementById('score').textContent = score;
            document.getElementById('bestScore').textContent = bestScore;
            
            // ê³ ë„ê³„ ì—…ë°ì´íŠ¸
            const altitudePercent = ((canvas.height - helicopter.y) / canvas.height) * 100;
            document.getElementById('altitudeFill').style.height = altitudePercent + '%';
            
            // ì—°ë£Œê³„ ì—…ë°ì´íŠ¸
            const fuelPercent = (helicopter.fuel / helicopter.maxFuel) * 100;
            document.getElementById('fuelFill').style.height = fuelPercent + '%';
        }

        // ë‚œì´ë„ ì„¤ì •
        function setDifficulty(newDifficulty) {
            difficulty = newDifficulty;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ì„¤ì • ì ìš©
            const settings = difficultySettings[difficulty];
            gameSpeed = settings.speed;
            obstacleSpawnRate = settings.spawnRate;
            helicopter.fuelConsumption = settings.fuelConsumption;
        }

        // ê²Œì„ ì œì–´ í•¨ìˆ˜ë“¤
        function startGame() {
            if (!gameRunning) {
                resetGame(); // ê²Œì„ ì‹œì‘ ì‹œ ì´ˆê¸°í™”
                gameRunning = true;
                gamePaused = false;
                gameLoop();
            }
        }

        function pauseGame() {
            gamePaused = !gamePaused;
            if (!gamePaused && gameRunning) {
                gameLoop();
            }
        }

        function resetGame() {
            gameRunning = false;
            gamePaused = false;
            distance = 0;
            score = 0;
            
            // í—¬ë¦¬ì½¥í„° ì´ˆê¸°í™”
            helicopter.x = 100;
            helicopter.y = canvas.height / 2;
            helicopter.velocityY = 0;
            helicopter.fuel = helicopter.maxFuel;
            helicopter.rotorAngle = 0;
            helicopter.trail = [];
            
            // ì„¤ì • ì´ˆê¸°í™”
            const settings = difficultySettings[difficulty];
            gameSpeed = settings.speed;
            obstacleSpawnRate = settings.spawnRate;
            helicopter.fuelConsumption = settings.fuelConsumption;
            
            windForce = 0;
            windDirection = 0;
            windChangeTimer = 0;
            
            // ê°ì²´ë“¤ ì´ˆê¸°í™”
            obstacles = [];
            particles = [];
            clouds = [];
            fuelPickups = [];
            
            document.getElementById('gameOver').style.display = 'none';
            updateDisplay();
        }

        // í‚¤ë³´ë“œ ë° ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.key === ' ') {
                e.preventDefault();
                liftHelicopter();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.code === 'Space' || e.key === ' ') {
                e.preventDefault();
            }
        });

        // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
        canvas.addEventListener('mousedown', (e) => {
            e.preventDefault();
            liftHelicopter();
        });

        canvas.addEventListener('click', (e) => {
            e.preventDefault();
            liftHelicopter();
        });

        // í„°ì¹˜ ì´ë²¤íŠ¸
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            liftHelicopter();
        });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
        });

        // ìº”ë²„ìŠ¤ì— í¬ì»¤ìŠ¤ ì„¤ì •
        canvas.setAttribute('tabindex', '0');
        canvas.style.outline = 'none';
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìº”ë²„ìŠ¤ì— í¬ì»¤ìŠ¤
        window.addEventListener('load', () => {
            canvas.focus();
        });

        // ì´ˆê¸°í™”
        updateDisplay();
        document.getElementById('bestScore').textContent = bestScore;
        
        // ê²Œì„ ì‹œì‘ ì „ì—ë„ í—¬ë¦¬ì½¥í„°ë¥¼ í™”ë©´ì— í‘œì‹œ
        initialDraw();
    </script>
</body>
</html>