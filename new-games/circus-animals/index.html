<!DOCTYPE html>
<html>
<head>
    <title>ì„œì»¤ìŠ¤ ë™ë¬¼ ì‡¼</title>
    
    <!-- Google Analytics -->
    <script src="../../analytics.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
            color: white;
            text-align: center;
            min-height: 100vh;
        }
        
        h1 {
            font-size: 3rem;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin: 20px auto;
            max-width: 900px;
            backdrop-filter: blur(10px);
        }
        
        canvas {
            border: 5px solid #fff;
            border-radius: 15px;
            background: linear-gradient(180deg, #74b9ff 0%, #00b894 100%);
        }
        
        .animal-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .animal-btn {
            background: linear-gradient(45deg, #fd79a8, #fdcb6e);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .animal-btn:hover {
            transform: scale(1.05);
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(45deg, #e17055, #d63031);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        .info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸª ì„œì»¤ìŠ¤ ë™ë¬¼ ì‡¼</h1>
    
    <div class="game-container">
        <div class="info">
            <div class="info-box">ê´€ê° ë§Œì¡±ë„: <span id="satisfaction">50</span>%</div>
            <div class="info-box">ê³µì—° ì ìˆ˜: <span id="score">0</span></div>
            <div class="info-box">ì‹œê°„: <span id="time">60</span>ì´ˆ</div>
        </div>
        
        <canvas id="gameCanvas" width="800" height="500"></canvas>
        
        <div class="animal-controls">
            <button class="animal-btn" onclick="commandAnimal('lion', 'jump')">ğŸ¦ ì‚¬ì ì í”„</button>
            <button class="animal-btn" onclick="commandAnimal('elephant', 'stand')">ğŸ˜ ì½”ë¼ë¦¬ ì„œê¸°</button>
            <button class="animal-btn" onclick="commandAnimal('monkey', 'flip')">ğŸµ ì›ìˆ­ì´ ì¬ì£¼ë„˜ê¸°</button>
            <button class="animal-btn" onclick="commandAnimal('lion', 'roar')">ğŸ¦ ì‚¬ì í¬íš¨</button>
            <button class="animal-btn" onclick="commandAnimal('elephant', 'dance')">ğŸ˜ ì½”ë¼ë¦¬ ì¶¤</button>
            <button class="animal-btn" onclick="commandAnimal('monkey', 'swing')">ğŸµ ì›ìˆ­ì´ ê·¸ë„¤</button>
        </div>
        
        <div class="controls">
            <button onclick="startShow()">ğŸ® ì‡¼ ì‹œì‘</button>
            <button onclick="resetShow()">ğŸ”„ ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let showRunning = false;
        let satisfaction = 50;
        let score = 0;
        let timeLeft = 60;
        let gameTimer = null;

        // ë™ë¬¼ë“¤
        const animals = {
            lion: {
                x: 150,
                y: 350,
                width: 80,
                height: 60,
                action: 'idle',
                actionTimer: 0,
                emoji: 'ğŸ¦'
            },
            elephant: {
                x: 350,
                y: 320,
                width: 100,
                height: 90,
                action: 'idle',
                actionTimer: 0,
                emoji: 'ğŸ˜'
            },
            monkey: {
                x: 550,
                y: 370,
                width: 60,
                height: 50,
                action: 'idle',
                actionTimer: 0,
                emoji: 'ğŸµ'
            }
        };

        let audience = [];
        let particles = [];

        function initializeAudience() {
            audience = [];
            for (let i = 0; i < 15; i++) {
                audience.push({
                    x: 50 + i * 45,
                    y: 450,
                    mood: 0.5,
                    clapping: false,
                    clapTimer: 0
                });
            }
        }

        function commandAnimal(animalType, action) {
            if (!showRunning) return;
            
            const animal = animals[animalType];
            if (animal.action !== 'idle') return; // ì´ë¯¸ í–‰ë™ ì¤‘
            
            animal.action = action;
            animal.actionTimer = 120; // 2ì´ˆ
            
            // ì„±ê³µë¥  ê³„ì‚°
            const success = Math.random() > 0.2; // 80% ì„±ê³µë¥ 
            
            if (success) {
                const points = calculatePoints(animalType, action);
                score += points;
                satisfaction = Math.min(100, satisfaction + 5);
                
                // ê´€ê° ë°˜ì‘
                audience.forEach(person => {
                    person.clapping = true;
                    person.clapTimer = 60;
                    person.mood = Math.min(1, person.mood + 0.1);
                });
                
                createSuccessParticles(animal.x, animal.y);
            } else {
                satisfaction = Math.max(0, satisfaction - 3);
                audience.forEach(person => {
                    person.mood = Math.max(0, person.mood - 0.05);
                });
            }
        }

        function calculatePoints(animalType, action) {
            const basePoints = {
                'lion': { 'jump': 100, 'roar': 80 },
                'elephant': { 'stand': 120, 'dance': 150 },
                'monkey': { 'flip': 90, 'swing': 110 }
            };
            
            return basePoints[animalType][action] || 50;
        }

        function updateAnimals() {
            Object.values(animals).forEach(animal => {
                if (animal.actionTimer > 0) {
                    animal.actionTimer--;
                    if (animal.actionTimer <= 0) {
                        animal.action = 'idle';
                    }
                }
            });
        }

        function updateAudience() {
            audience.forEach(person => {
                if (person.clapping && person.clapTimer > 0) {
                    person.clapTimer--;
                    if (person.clapTimer <= 0) {
                        person.clapping = false;
                    }
                }
                
                // ì‹œê°„ì´ ì§€ë‚˜ë©´ì„œ ë§Œì¡±ë„ ì²œì²œíˆ ê°ì†Œ
                if (Math.random() < 0.002) {
                    person.mood = Math.max(0, person.mood - 0.01);
                }
            });
        }

        function createSuccessParticles(x, y) {
            for (let i = 0; i < 10; i++) {
                particles.push({
                    x: x + Math.random() * 80,
                    y: y + Math.random() * 60,
                    vx: (Math.random() - 0.5) * 6,
                    vy: -Math.random() * 8,
                    life: 60,
                    color: '#FFD700',
                    size: Math.random() * 5 + 3
                });
            }
        }

        function updateParticles() {
            particles.forEach((particle, index) => {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.vy += 0.2;
                particle.life--;
                
                if (particle.life <= 0) {
                    particles.splice(index, 1);
                }
            });
        }

        function drawBackground() {
            // ì„œì»¤ìŠ¤ í…íŠ¸ ë°°ê²½
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#74b9ff');
            gradient.addColorStop(1, '#00b894');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ë¬´ëŒ€
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, 400, canvas.width, 100);
            
            // ìŠ¤í¬íŠ¸ë¼ì´íŠ¸
            ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.beginPath();
            ctx.arc(200, 100, 150, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(400, 100, 150, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(600, 100, 150, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawAnimals() {
            Object.entries(animals).forEach(([type, animal]) => {
                ctx.save();
                
                // í–‰ë™ì— ë”°ë¥¸ ìœ„ì¹˜ ì¡°ì •
                let offsetY = 0;
                let offsetX = 0;
                
                switch(animal.action) {
                    case 'jump':
                        offsetY = -Math.sin(animal.actionTimer * 0.2) * 30;
                        break;
                    case 'stand':
                        offsetY = -20;
                        break;
                    case 'flip':
                        ctx.translate(animal.x + animal.width/2, animal.y + animal.height/2);
                        ctx.rotate(animal.actionTimer * 0.1);
                        ctx.translate(-animal.width/2, -animal.height/2);
                        break;
                    case 'dance':
                        offsetX = Math.sin(animal.actionTimer * 0.3) * 10;
                        break;
                    case 'swing':
                        offsetX = Math.sin(animal.actionTimer * 0.2) * 20;
                        break;
                }
                
                // ë™ë¬¼ ê·¸ë¦¬ê¸°
                ctx.font = `${animal.width}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText(
                    animal.emoji, 
                    animal.x + animal.width/2 + offsetX, 
                    animal.y + animal.height + offsetY
                );
                
                // í–‰ë™ í‘œì‹œ
                if (animal.action !== 'idle') {
                    ctx.fillStyle = '#FFFFFF';
                    ctx.font = '16px Arial';
                    ctx.fillText(
                        animal.action.toUpperCase() + '!',
                        animal.x + animal.width/2,
                        animal.y - 10
                    );
                }
                
                ctx.restore();
            });
        }

        function drawAudience() {
            audience.forEach(person => {
                // ê´€ê° ëª¸
                const moodColor = person.mood > 0.7 ? '#27ae60' : 
                                person.mood > 0.3 ? '#f39c12' : '#e74c3c';
                ctx.fillStyle = moodColor;
                ctx.fillRect(person.x - 8, person.y - 20, 16, 20);
                
                // ë¨¸ë¦¬
                ctx.fillStyle = '#f4d03f';
                ctx.beginPath();
                ctx.arc(person.x, person.y - 25, 8, 0, Math.PI * 2);
                ctx.fill();
                
                // ë°•ìˆ˜ ì¤‘ì¼ ë•Œ
                if (person.clapping) {
                    ctx.fillStyle = '#FFFFFF';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('ğŸ‘', person.x, person.y - 35);
                }
            });
        }

        function drawParticles() {
            particles.forEach(particle => {
                ctx.globalAlpha = particle.life / 60;
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            });
        }

        function updateTimer() {
            if (!showRunning) return;
            
            timeLeft--;
            if (timeLeft <= 0) {
                endShow();
            }
        }

        function endShow() {
            showRunning = false;
            clearInterval(gameTimer);
            
            let result = '';
            if (satisfaction >= 80) {
                result = 'ğŸ‰ ëŒ€ì„±ê³µ! ê´€ê°ë“¤ì´ ì—´ê´‘í–ˆìŠµë‹ˆë‹¤!';
            } else if (satisfaction >= 60) {
                result = 'ğŸ‘ ì„±ê³µ! ì¢‹ì€ ê³µì—°ì´ì—ˆìŠµë‹ˆë‹¤!';
            } else if (satisfaction >= 40) {
                result = 'ğŸ˜ ë³´í†µ... ë” ì—°ìŠµì´ í•„ìš”í•´ìš”.';
            } else {
                result = 'ğŸ˜ ì‹¤íŒ¨... ê´€ê°ë“¤ì´ ì‹¤ë§í–ˆìŠµë‹ˆë‹¤.';
            }
            
            alert(`${result}\nìµœì¢… ì ìˆ˜: ${score}ì \nê´€ê° ë§Œì¡±ë„: ${satisfaction}%`);
        }

        function update() {
            if (!showRunning) return;
            
            updateAnimals();
            updateAudience();
            updateParticles();
            
            updateDisplay();
        }

        function draw() {
            drawBackground();
            drawAnimals();
            drawAudience();
            drawParticles();
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function updateDisplay() {
            document.getElementById('satisfaction').textContent = Math.floor(satisfaction);
            document.getElementById('score').textContent = score;
            document.getElementById('time').textContent = timeLeft;
        }

        function startShow() {
            showRunning = true;
            satisfaction = 50;
            score = 0;
            timeLeft = 60;
            
            // ë™ë¬¼ë“¤ ì´ˆê¸°í™”
            Object.values(animals).forEach(animal => {
                animal.action = 'idle';
                animal.actionTimer = 0;
            });
            
            initializeAudience();
            particles = [];
            
            // íƒ€ì´ë¨¸ ì‹œì‘
            clearInterval(gameTimer);
            gameTimer = setInterval(updateTimer, 1000);
            
            updateDisplay();
        }

        function resetShow() {
            showRunning = false;
            clearInterval(gameTimer);
            satisfaction = 50;
            score = 0;
            timeLeft = 60;
            
            updateDisplay();
        }

        // ì´ˆê¸°í™”
        resetShow();
        gameLoop();
    </script>
</body>
</html>