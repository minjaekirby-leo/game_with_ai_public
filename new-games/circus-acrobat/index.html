<!DOCTYPE html>
<html>
<head>
    <title>ì„œì»¤ìŠ¤ ê³¡ì˜ˆì‚¬ ê²Œì„</title>
    
    <!-- Google Analytics -->
    <script src="../../analytics.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            color: white;
            text-align: center;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        h1 {
            font-size: 3rem;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            animation: circus 3s ease-in-out infinite;
        }
        
        @keyframes circus {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin: 20px auto;
            max-width: 800px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }
        
        canvas {
            border: 5px solid #fff;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            background: linear-gradient(180deg, #87CEEB 0%, #DDA0DD 100%);
        }
        
        .game-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .balance-meter {
            width: 300px;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 20px auto;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        .balance-indicator {
            width: 20px;
            height: 16px;
            background: #FFD700;
            border-radius: 8px;
            position: absolute;
            top: 2px;
            transition: left 0.1s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .balance-zones {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            display: flex;
        }
        
        .danger-zone {
            background: rgba(255, 0, 0, 0.3);
            flex: 1;
        }
        
        .safe-zone {
            background: rgba(0, 255, 0, 0.3);
            flex: 2;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(5px);
        }
        
        .audience {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            animation: cheer 2s ease-in-out infinite;
        }
        
        @keyframes cheer {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
        }
        
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 100;
            border: 3px solid #FF6B35;
        }
        
        .difficulty-selector {
            margin: 20px 0;
        }
        
        .difficulty-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        
        .difficulty-btn.active {
            background: #4CAF50;
            border-color: #4CAF50;
        }
        
        .wind-indicator {
            margin: 10px 0;
            font-size: 1.1rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸª ì„œì»¤ìŠ¤ ê³¡ì˜ˆì‚¬</h1>
    
    <div class="instructions">
        <p><strong>ğŸ® ê²Œì„ ë°©ë²•:</strong></p>
        <p>â† â†’ í‚¤ë¡œ ê³¡ì˜ˆì‚¬ì˜ ê· í˜•ì„ ë§ì¶°ì£¼ì„¸ìš”!</p>
        <p>ê· í˜• ë¯¸í„°ê°€ ë¹¨ê°„ êµ¬ì—­ì— ë„ˆë¬´ ì˜¤ë˜ ìˆìœ¼ë©´ ë–¨ì–´ì§‘ë‹ˆë‹¤!</p>
        <p>ë°”ëŒì˜ ì˜í–¥ì„ ë°›ìœ¼ë‹ˆ ì£¼ì˜í•˜ì„¸ìš”!</p>
    </div>
    
    <div class="game-container">
        <div class="game-info">
            <div class="info-box">ì ìˆ˜: <span id="score">0</span></div>
            <div class="info-box">ì‹œê°„: <span id="time">0</span>ì´ˆ</div>
            <div class="info-box">ìµœê³  ê¸°ë¡: <span id="bestScore">0</span></div>
        </div>
        
        <div class="difficulty-selector">
            <button class="difficulty-btn active" onclick="setDifficulty('easy')">ğŸŸ¢ ì‰¬ì›€</button>
            <button class="difficulty-btn" onclick="setDifficulty('medium')">ğŸŸ¡ ë³´í†µ</button>
            <button class="difficulty-btn" onclick="setDifficulty('hard')">ğŸ”´ ì–´ë ¤ì›€</button>
        </div>
        
        <div class="wind-indicator" id="windIndicator">ğŸŒ¬ï¸ ë°”ëŒ: ì—†ìŒ</div>
        
        <div class="balance-meter">
            <div class="balance-zones">
                <div class="danger-zone"></div>
                <div class="safe-zone"></div>
                <div class="danger-zone"></div>
            </div>
            <div class="balance-indicator" id="balanceIndicator"></div>
        </div>
        
        <canvas id="gameCanvas" width="700" height="400"></canvas>
        
        <div class="controls">
            <button onclick="startGame()">ğŸª ê²Œì„ ì‹œì‘</button>
            <button onclick="pauseGame()">â¸ï¸ ì¼ì‹œì •ì§€</button>
            <button onclick="resetGame()">ğŸ”„ ë‹¤ì‹œ ì‹œì‘</button>
        </div>
        
        <div class="audience">ğŸ‘ ğŸ‘ ğŸ‘</div>
        
        <div class="game-over" id="gameOver">
            <h2>ğŸª ê³µì—° ì¢…ë£Œ!</h2>
            <p>ìƒì¡´ ì‹œê°„: <span id="finalTime">0</span>ì´ˆ</p>
            <p>ìµœì¢… ì ìˆ˜: <span id="finalScore">0</span></p>
            <p id="newRecord" style="display: none; color: #FFD700;">ğŸ† ìƒˆë¡œìš´ ê¸°ë¡!</p>
            <button onclick="resetGame()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // ìº”ë²„ìŠ¤ ì„¤ì •
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ê²Œì„ ìƒíƒœ
        let gameRunning = false;
        let gamePaused = false;
        let score = 0;
        let gameTime = 0;
        let bestScore = localStorage.getItem('circusBestScore') || 0;
        let difficulty = 'easy';

        // ê³¡ì˜ˆì‚¬ ì„¤ì •
        const acrobat = {
            x: canvas.width / 2,
            y: 200,
            width: 30,
            height: 40,
            balance: 0, // -100 ~ 100
            balanceVelocity: 0,
            angle: 0
        };

        // ì¤„íƒ€ê¸° ì¤„ ì„¤ì •
        const rope = {
            y: 240,
            sway: 0,
            swayVelocity: 0
        };

        // ê²Œì„ ì„¤ì •
        let balanceDecay = 0.5; // ê· í˜•ì´ ì¤‘ì•™ìœ¼ë¡œ ëŒì•„ê°€ëŠ” ì†ë„
        let windForce = 0;
        let windDirection = 0;
        let windChangeTimer = 0;
        let dangerTime = 0; // ìœ„í—˜ êµ¬ì—­ì— ìˆëŠ” ì‹œê°„
        const maxDangerTime = 180; // 3ì´ˆ (60fps ê¸°ì¤€)

        // ë‚œì´ë„ ì„¤ì •
        const difficultySettings = {
            easy: { balanceDecay: 0.3, windStrength: 0.2, dangerLimit: 240 },
            medium: { balanceDecay: 0.5, windStrength: 0.4, dangerLimit: 180 },
            hard: { balanceDecay: 0.7, windStrength: 0.6, dangerLimit: 120 }
        };

        // íŒŒí‹°í´ ì‹œìŠ¤í…œ
        let particles = [];

        class Particle {
            constructor(x, y, color, type = 'normal') {
                this.x = x;
                this.y = y;
                this.dx = (Math.random() - 0.5) * 4;
                this.dy = (Math.random() - 0.5) * 4;
                this.color = color;
                this.life = 60;
                this.maxLife = 60;
                this.size = Math.random() * 3 + 1;
                this.type = type;
            }
            
            update() {
                this.x += this.dx;
                this.y += this.dy;
                this.life--;
                
                if (this.type === 'sparkle') {
                    this.dy -= 0.1; // ìœ„ë¡œ ì˜¬ë¼ê°
                } else {
                    this.dy += 0.1; // ì¤‘ë ¥
                }
                
                this.dx *= 0.99; // ê³µê¸° ì €í•­
            }
            
            draw() {
                const alpha = this.life / this.maxLife;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = this.color;
                
                if (this.type === 'sparkle') {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    ctx.fillRect(this.x, this.y, this.size, this.size);
                }
                
                ctx.globalAlpha = 1;
            }
            
            isDead() {
                return this.life <= 0;
            }
        }

        // ë‚œì´ë„ ì„¤ì •
        function setDifficulty(newDifficulty) {
            difficulty = newDifficulty;
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ì„¤ì • ì ìš©
            const settings = difficultySettings[difficulty];
            balanceDecay = settings.balanceDecay;
        }

        // ë°°ê²½ ê·¸ë¦¬ê¸°
        function drawBackground() {
            // í•˜ëŠ˜ ê·¸ë¼ë°ì´ì…˜
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#DDA0DD');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ì„œì»¤ìŠ¤ í…íŠ¸ ë°°ê²½
            ctx.fillStyle = '#8B0000';
            ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
            
            // ê´€ì¤‘ì„
            for (let i = 0; i < 10; i++) {
                ctx.fillStyle = `hsl(${Math.random() * 360}, 70%, 60%)`;
                ctx.fillRect(i * 70 + 10, canvas.height - 40, 20, 30);
            }
        }

        // ì¤„ ê·¸ë¦¬ê¸°
        function drawRope() {
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 5;
            ctx.beginPath();
            
            // ì¤„ì˜ í”ë“¤ë¦¼ íš¨ê³¼
            const segments = 20;
            for (let i = 0; i <= segments; i++) {
                const x = (canvas.width / segments) * i;
                const sway = Math.sin((i / segments) * Math.PI * 2 + rope.sway) * 5;
                const y = rope.y + sway;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            
            // ì¤„ ì§€ì§€ëŒ€
            ctx.fillStyle = '#654321';
            ctx.fillRect(-10, rope.y - 20, 20, 40);
            ctx.fillRect(canvas.width - 10, rope.y - 20, 20, 40);
        }

        // ê³¡ì˜ˆì‚¬ ê·¸ë¦¬ê¸°
        function drawAcrobat() {
            ctx.save();
            ctx.translate(acrobat.x, acrobat.y);
            ctx.rotate(acrobat.angle);
            
            // ëª¸ì²´
            ctx.fillStyle = '#FF1493';
            ctx.fillRect(-acrobat.width/2, -acrobat.height/2, acrobat.width, acrobat.height);
            
            // ë¨¸ë¦¬
            ctx.fillStyle = '#FFE4B5';
            ctx.beginPath();
            ctx.arc(0, -acrobat.height/2 - 10, 12, 0, Math.PI * 2);
            ctx.fill();
            
            // íŒ” (ê· í˜• ì¡ê¸°)
            ctx.strokeStyle = '#FFE4B5';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(-acrobat.width/2 - 15, -10);
            ctx.lineTo(-acrobat.width/2, -5);
            ctx.moveTo(acrobat.width/2 + 15, -10);
            ctx.lineTo(acrobat.width/2, -5);
            ctx.stroke();
            
            // ë‹¤ë¦¬
            ctx.beginPath();
            ctx.moveTo(-5, acrobat.height/2);
            ctx.lineTo(-8, acrobat.height/2 + 15);
            ctx.moveTo(5, acrobat.height/2);
            ctx.lineTo(8, acrobat.height/2 + 15);
            ctx.stroke();
            
            ctx.restore();
            
            // ê· í˜• ë§‰ëŒ€
            ctx.save();
            ctx.translate(acrobat.x, acrobat.y - 20);
            ctx.rotate(acrobat.balance * 0.01);
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(-50, 0);
            ctx.lineTo(50, 0);
            ctx.stroke();
            ctx.restore();
        }

        // ë°”ëŒ ì—…ë°ì´íŠ¸
        function updateWind() {
            windChangeTimer++;
            
            if (windChangeTimer > 180) { // 3ì´ˆë§ˆë‹¤ ë°”ëŒ ë³€ê²½
                windDirection = (Math.random() - 0.5) * 2; // -1 ~ 1
                windForce = Math.random() * difficultySettings[difficulty].windStrength;
                windChangeTimer = 0;
            }
            
            // ë°”ëŒ í‘œì‹œ ì—…ë°ì´íŠ¸
            let windText = 'ğŸŒ¬ï¸ ë°”ëŒ: ';
            if (Math.abs(windForce) < 0.1) {
                windText += 'ì—†ìŒ';
            } else if (windDirection > 0) {
                windText += `ì˜¤ë¥¸ìª½ ${windForce.toFixed(1)}`;
            } else {
                windText += `ì™¼ìª½ ${Math.abs(windForce).toFixed(1)}`;
            }
            
            document.getElementById('windIndicator').textContent = windText;
        }

        // ê³¡ì˜ˆì‚¬ ì—…ë°ì´íŠ¸
        function updateAcrobat() {
            // ë°”ëŒ ì˜í–¥
            acrobat.balanceVelocity += windDirection * windForce;
            
            // ê· í˜• ì—…ë°ì´íŠ¸
            acrobat.balance += acrobat.balanceVelocity;
            
            // ê· í˜•ì´ ì¤‘ì•™ìœ¼ë¡œ ëŒì•„ê°€ëŠ” í˜
            acrobat.balanceVelocity -= acrobat.balance * 0.01;
            
            // ë§ˆì°°
            acrobat.balanceVelocity *= 0.95;
            
            // ê· í˜• ì œí•œ
            acrobat.balance = Math.max(-100, Math.min(100, acrobat.balance));
            
            // ê°ë„ ì—…ë°ì´íŠ¸
            acrobat.angle = acrobat.balance * 0.02;
            
            // ì¤„ í”ë“¤ë¦¼
            rope.swayVelocity += acrobat.balance * 0.001;
            rope.sway += rope.swayVelocity;
            rope.swayVelocity *= 0.98;
            
            // ìœ„í—˜ êµ¬ì—­ í™•ì¸
            if (Math.abs(acrobat.balance) > 60) {
                dangerTime++;
                
                // ìœ„í—˜ íŒŒí‹°í´
                if (Math.random() < 0.3) {
                    particles.push(new Particle(
                        acrobat.x + (Math.random() - 0.5) * 40,
                        acrobat.y + (Math.random() - 0.5) * 40,
                        '#FF0000'
                    ));
                }
                
                if (dangerTime > difficultySettings[difficulty].dangerLimit) {
                    gameOver();
                }
            } else {
                dangerTime = Math.max(0, dangerTime - 2);
                
                // ì•ˆì „ êµ¬ì—­ íŒŒí‹°í´
                if (Math.random() < 0.1) {
                    particles.push(new Particle(
                        acrobat.x + (Math.random() - 0.5) * 40,
                        acrobat.y + (Math.random() - 0.5) * 40,
                        '#00FF00',
                        'sparkle'
                    ));
                }
            }
            
            // ê· í˜• ë¯¸í„° ì—…ë°ì´íŠ¸
            const indicator = document.getElementById('balanceIndicator');
            const meterWidth = 300;
            const position = ((acrobat.balance + 100) / 200) * (meterWidth - 20);
            indicator.style.left = position + 'px';
            
            // ìœ„í—˜ë„ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
            if (Math.abs(acrobat.balance) > 60) {
                indicator.style.background = '#FF0000';
            } else if (Math.abs(acrobat.balance) > 30) {
                indicator.style.background = '#FFA500';
            } else {
                indicator.style.background = '#00FF00';
            }
        }

        // ê²Œì„ ì—…ë°ì´íŠ¸
        function update() {
            if (!gameRunning || gamePaused) return;
            
            gameTime++;
            score = Math.floor(gameTime / 60); // 1ì´ˆë§ˆë‹¤ 1ì 
            
            updateWind();
            updateAcrobat();
            
            // íŒŒí‹°í´ ì—…ë°ì´íŠ¸
            particles.forEach(particle => particle.update());
            particles = particles.filter(particle => !particle.isDead());
            
            updateDisplay();
        }

        // ê²Œì„ ê·¸ë¦¬ê¸°
        function draw() {
            drawBackground();
            drawRope();
            drawAcrobat();
            
            // íŒŒí‹°í´ ê·¸ë¦¬ê¸°
            particles.forEach(particle => particle.draw());
            
            // ìœ„í—˜ë„ í‘œì‹œ
            if (Math.abs(acrobat.balance) > 60) {
                ctx.fillStyle = `rgba(255, 0, 0, ${0.1 + (dangerTime / difficultySettings[difficulty].dangerLimit) * 0.3})`;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
        }

        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('time').textContent = Math.floor(gameTime / 60);
            document.getElementById('bestScore').textContent = bestScore;
        }

        // ê²Œì„ ì‹œì‘
        function startGame() {
            if (!gameRunning) {
                gameRunning = true;
                gamePaused = false;
                gameTime = 0;
                score = 0;
                dangerTime = 0;
                
                // ê³¡ì˜ˆì‚¬ ì´ˆê¸°í™”
                acrobat.balance = 0;
                acrobat.balanceVelocity = 0;
                acrobat.angle = 0;
                
                // ì¤„ ì´ˆê¸°í™”
                rope.sway = 0;
                rope.swayVelocity = 0;
                
                // ë°”ëŒ ì´ˆê¸°í™”
                windForce = 0;
                windDirection = 0;
                windChangeTimer = 0;
                
                particles = [];
                
                document.getElementById('gameOver').style.display = 'none';
                updateDisplay();
            }
        }

        // ê²Œì„ ì¼ì‹œì •ì§€
        function pauseGame() {
            if (gameRunning) {
                gamePaused = !gamePaused;
            }
        }

        // ê²Œì„ ë¦¬ì…‹
        function resetGame() {
            gameRunning = false;
            gamePaused = false;
            document.getElementById('gameOver').style.display = 'none';
            
            // ì´ˆê¸° ìƒíƒœë¡œ ë¦¬ì…‹
            acrobat.balance = 0;
            acrobat.balanceVelocity = 0;
            acrobat.angle = 0;
            rope.sway = 0;
            rope.swayVelocity = 0;
            particles = [];
            
            updateDisplay();
        }

        // ê²Œì„ ì˜¤ë²„
        function gameOver() {
            gameRunning = false;
            
            // ìµœê³  ê¸°ë¡ í™•ì¸
            let isNewRecord = false;
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem('circusBestScore', bestScore);
                isNewRecord = true;
            }
            
            document.getElementById('finalTime').textContent = Math.floor(gameTime / 60);
            document.getElementById('finalScore').textContent = score;
            document.getElementById('newRecord').style.display = isNewRecord ? 'block' : 'none';
            document.getElementById('gameOver').style.display = 'block';
            
            // ë‚™í•˜ íŒŒí‹°í´
            for (let i = 0; i < 20; i++) {
                particles.push(new Particle(
                    acrobat.x + (Math.random() - 0.5) * 60,
                    acrobat.y + (Math.random() - 0.5) * 60,
                    '#FF6B35'
                ));
            }
            
            updateDisplay();
        }

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keydown', (e) => {
            if (!gameRunning || gamePaused) return;
            
            switch(e.code) {
                case 'ArrowLeft':
                    e.preventDefault();
                    acrobat.balanceVelocity -= 2;
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    acrobat.balanceVelocity += 2;
                    break;
                case 'Space':
                    e.preventDefault();
                    if (!gameRunning) {
                        startGame();
                    }
                    break;
            }
        });

        // ì´ˆê¸°í™”
        updateDisplay();
        gameLoop();
        
        console.log('ì„œì»¤ìŠ¤ ê³¡ì˜ˆì‚¬ ê²Œì„ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
    </script>
</body>
</html>