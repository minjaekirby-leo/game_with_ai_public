<!DOCTYPE html>
<html>
<head>
    <title>ë‹¨ì–´ ì°¾ê¸°</title>
    
    <!-- Google Analytics -->
    <script src="../../analytics.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            min-height: 100vh;
        }
        
        h1 {
            font-size: 3rem;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin: 20px auto;
            max-width: 1000px;
            backdrop-filter: blur(10px);
        }
        
        .game-area {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .grid-container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
        }
        
        .word-grid {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            grid-template-rows: repeat(15, 1fr);
            gap: 2px;
            width: 450px;
            height: 450px;
        }
        
        .grid-cell {
            width: 28px;
            height: 28px;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            color: #333;
            user-select: none;
        }
        
        .grid-cell:hover {
            background: #e3f2fd;
        }
        
        .grid-cell.selected {
            background: #2196f3;
            color: white;
        }
        
        .grid-cell.found {
            background: #4caf50;
            color: white;
        }
        
        .word-list {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            width: 200px;
        }
        
        .word-item {
            background: rgba(255, 255, 255, 0.3);
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .word-item.found {
            background: #4caf50;
            text-decoration: line-through;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(45deg, #00b894, #00a085);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        .info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ë‹¨ì–´ ì°¾ê¸°</h1>
    
    <div class="game-container">
        <div class="info">
            <div class="info-box">ì°¾ì€ ë‹¨ì–´: <span id="foundWords">0</span>/<span id="totalWords">10</span></div>
            <div class="info-box">ì‹œê°„: <span id="time">00:00</span></div>
            <div class="info-box">ì ìˆ˜: <span id="score">0</span></div>
        </div>
        
        <div class="game-area">
            <div class="grid-container">
                <div class="word-grid" id="wordGrid"></div>
            </div>
            
            <div class="word-list" id="wordList">
                <h3>ì°¾ì„ ë‹¨ì–´ë“¤</h3>
            </div>
        </div>
        
        <div class="controls">
            <button onclick="newGame()">ğŸ® ìƒˆ ê²Œì„</button>
            <button onclick="showHint()">ğŸ’¡ íŒíŠ¸</button>
            <button onclick="pauseGame()">â¸ï¸ ì¼ì‹œì •ì§€</button>
        </div>
    </div>

    <script>
        let gameRunning = false;
        let gamePaused = false;
        let startTime = 0;
        let gameTimer = null;
        let score = 0;
        
        const GRID_SIZE = 15;
        let grid = [];
        let words = [];
        let foundWords = [];
        let selectedCells = [];
        let isSelecting = false;
        
        // ë‹¨ì–´ ëª©ë¡
        const wordList = [
            'ì‚¬ê³¼', 'ë°”ë‚˜ë‚˜', 'ë”¸ê¸°', 'í¬ë„', 'ìˆ˜ë°•', 'ì°¸ì™¸', 'ë³µìˆ­ì•„', 'ìë‘', 'ê°', 'ë°°',
            'ê³ ì–‘ì´', 'ê°•ì•„ì§€', 'í† ë¼', 'í–„ìŠ¤í„°', 'ìƒˆ', 'ë¬¼ê³ ê¸°', 'ê±°ë¶ì´', 'ì•µë¬´ìƒˆ',
            'ì¶•êµ¬', 'ë†êµ¬', 'ì•¼êµ¬', 'í…Œë‹ˆìŠ¤', 'ë°°êµ¬', 'íƒêµ¬', 'ìˆ˜ì˜', 'ë‹¬ë¦¬ê¸°',
            'í•™êµ', 'ì§‘', 'ê³µì›', 'ë³‘ì›', 'ë§ˆíŠ¸', 'ë„ì„œê´€', 'ì˜í™”ê´€', 'ë†€ì´í„°',
            'ë´„', 'ì—¬ë¦„', 'ê°€ì„', 'ê²¨ìš¸', 'ë¹„', 'ëˆˆ', 'ë°”ëŒ', 'êµ¬ë¦„'
        ];

        function initializeGrid() {
            grid = [];
            for (let i = 0; i < GRID_SIZE; i++) {
                grid[i] = [];
                for (let j = 0; j < GRID_SIZE; j++) {
                    grid[i][j] = '';
                }
            }
        }

        function selectRandomWords() {
            words = [];
            const shuffled = [...wordList].sort(() => Math.random() - 0.5);
            words = shuffled.slice(0, 10);
            foundWords = [];
        }

        function placeWordsInGrid() {
            words.forEach(word => {
                let placed = false;
                let attempts = 0;
                
                while (!placed && attempts < 100) {
                    const direction = Math.floor(Math.random() * 8); // 8ë°©í–¥
                    const startRow = Math.floor(Math.random() * GRID_SIZE);
                    const startCol = Math.floor(Math.random() * GRID_SIZE);
                    
                    if (canPlaceWord(word, startRow, startCol, direction)) {
                        placeWord(word, startRow, startCol, direction);
                        placed = true;
                    }
                    attempts++;
                }
            });
        }

        function canPlaceWord(word, row, col, direction) {
            const directions = [
                [-1, -1], [-1, 0], [-1, 1],
                [0, -1],           [0, 1],
                [1, -1],  [1, 0],  [1, 1]
            ];
            
            const [dRow, dCol] = directions[direction];
            
            for (let i = 0; i < word.length; i++) {
                const newRow = row + i * dRow;
                const newCol = col + i * dCol;
                
                if (newRow < 0 || newRow >= GRID_SIZE || newCol < 0 || newCol >= GRID_SIZE) {
                    return false;
                }
                
                if (grid[newRow][newCol] !== '' && grid[newRow][newCol] !== word[i]) {
                    return false;
                }
            }
            
            return true;
        }

        function placeWord(word, row, col, direction) {
            const directions = [
                [-1, -1], [-1, 0], [-1, 1],
                [0, -1],           [0, 1],
                [1, -1],  [1, 0],  [1, 1]
            ];
            
            const [dRow, dCol] = directions[direction];
            
            for (let i = 0; i < word.length; i++) {
                const newRow = row + i * dRow;
                const newCol = col + i * dCol;
                grid[newRow][newCol] = word[i];
            }
        }

        function fillEmptyCells() {
            const koreanChars = 'ã„±ã„´ã„·ã„¹ã…ã…‚ã……ã…‡ã…ˆã…Šã…‹ã…Œã…ã…ê°€ë‚˜ë‹¤ë¼ë§ˆë°”ì‚¬ì•„ìì°¨ì¹´íƒ€íŒŒí•˜';
            
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    if (grid[i][j] === '') {
                        grid[i][j] = koreanChars[Math.floor(Math.random() * koreanChars.length)];
                    }
                }
            }
        }

        function renderGrid() {
            const gridElement = document.getElementById('wordGrid');
            gridElement.innerHTML = '';
            
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.textContent = grid[i][j];
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    cell.addEventListener('mousedown', startSelection);
                    cell.addEventListener('mouseenter', continueSelection);
                    cell.addEventListener('mouseup', endSelection);
                    
                    gridElement.appendChild(cell);
                }
            }
        }

        function renderWordList() {
            const wordListElement = document.getElementById('wordList');
            wordListElement.innerHTML = '<h3>ì°¾ì„ ë‹¨ì–´ë“¤</h3>';
            
            words.forEach(word => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                wordItem.textContent = word;
                
                if (foundWords.includes(word)) {
                    wordItem.classList.add('found');
                }
                
                wordListElement.appendChild(wordItem);
            });
        }

        function startSelection(e) {
            if (!gameRunning || gamePaused) return;
            
            isSelecting = true;
            selectedCells = [];
            clearSelection();
            
            const row = parseInt(e.target.dataset.row);
            const col = parseInt(e.target.dataset.col);
            
            selectedCells.push({row, col});
            e.target.classList.add('selected');
        }

        function continueSelection(e) {
            if (!isSelecting) return;
            
            const row = parseInt(e.target.dataset.row);
            const col = parseInt(e.target.dataset.col);
            
            // ì§ì„ ìƒì— ìˆëŠ”ì§€ í™•ì¸
            if (selectedCells.length > 0) {
                const firstCell = selectedCells[0];
                const isValidDirection = isInLine(firstCell.row, firstCell.col, row, col);
                
                if (isValidDirection) {
                    clearSelection();
                    selectedCells = getLineCells(firstCell.row, firstCell.col, row, col);
                    selectedCells.forEach(cell => {
                        const cellElement = document.querySelector(`[data-row="${cell.row}"][data-col="${cell.col}"]`);
                        cellElement.classList.add('selected');
                    });
                }
            }
        }

        function endSelection() {
            if (!isSelecting) return;
            
            isSelecting = false;
            checkSelectedWord();
        }

        function isInLine(row1, col1, row2, col2) {
            const dRow = row2 - row1;
            const dCol = col2 - col1;
            
            // ê°™ì€ í–‰, ì—´, ë˜ëŠ” ëŒ€ê°ì„ ì¸ì§€ í™•ì¸
            return dRow === 0 || dCol === 0 || Math.abs(dRow) === Math.abs(dCol);
        }

        function getLineCells(row1, col1, row2, col2) {
            const cells = [];
            const dRow = row2 - row1;
            const dCol = col2 - col1;
            const steps = Math.max(Math.abs(dRow), Math.abs(dCol));
            
            const stepRow = steps === 0 ? 0 : dRow / steps;
            const stepCol = steps === 0 ? 0 : dCol / steps;
            
            for (let i = 0; i <= steps; i++) {
                cells.push({
                    row: row1 + Math.round(i * stepRow),
                    col: col1 + Math.round(i * stepCol)
                });
            }
            
            return cells;
        }

        function checkSelectedWord() {
            if (selectedCells.length < 2) {
                clearSelection();
                return;
            }
            
            const selectedWord = selectedCells.map(cell => grid[cell.row][cell.col]).join('');
            const reversedWord = selectedWord.split('').reverse().join('');
            
            let foundWord = null;
            if (words.includes(selectedWord) && !foundWords.includes(selectedWord)) {
                foundWord = selectedWord;
            } else if (words.includes(reversedWord) && !foundWords.includes(reversedWord)) {
                foundWord = reversedWord;
            }
            
            if (foundWord) {
                foundWords.push(foundWord);
                score += foundWord.length * 10;
                
                // ì°¾ì€ ë‹¨ì–´ ì…€ë“¤ì„ ì˜êµ¬ì ìœ¼ë¡œ í‘œì‹œ
                selectedCells.forEach(cell => {
                    const cellElement = document.querySelector(`[data-row="${cell.row}"][data-col="${cell.col}"]`);
                    cellElement.classList.remove('selected');
                    cellElement.classList.add('found');
                });
                
                renderWordList();
                updateDisplay();
                checkGameComplete();
            } else {
                clearSelection();
            }
        }

        function clearSelection() {
            document.querySelectorAll('.grid-cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
        }

        function showHint() {
            if (!gameRunning || gamePaused) return;
            
            // ì•„ì§ ì°¾ì§€ ëª»í•œ ë‹¨ì–´ ì¤‘ í•˜ë‚˜ë¥¼ ëœë¤í•˜ê²Œ ì„ íƒ
            const remainingWords = words.filter(word => !foundWords.includes(word));
            if (remainingWords.length === 0) return;
            
            const hintWord = remainingWords[Math.floor(Math.random() * remainingWords.length)];
            
            // í•´ë‹¹ ë‹¨ì–´ì˜ ì²« ê¸€ìë“¤ì„ ì ê¹ í•˜ì´ë¼ì´íŠ¸
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    if (grid[i][j] === hintWord[0]) {
                        const cell = document.querySelector(`[data-row="${i}"][data-col="${j}"]`);
                        cell.style.background = '#FFD700';
                        setTimeout(() => {
                            if (!cell.classList.contains('found')) {
                                cell.style.background = 'white';
                            }
                        }, 2000);
                    }
                }
            }
            
            score = Math.max(0, score - 20); // íŒíŠ¸ ì‚¬ìš© í˜ë„í‹°
            updateDisplay();
        }

        function checkGameComplete() {
            if (foundWords.length === words.length) {
                gameRunning = false;
                clearInterval(gameTimer);
                
                const timeBonus = Math.max(0, 300 - Math.floor((Date.now() - startTime) / 1000)) * 5;
                score += timeBonus;
                
                setTimeout(() => {
                    alert(`ğŸ‰ ëª¨ë“  ë‹¨ì–´ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!\nìµœì¢… ì ìˆ˜: ${score}ì \nì‹œê°„ ë³´ë„ˆìŠ¤: ${timeBonus}ì `);
                }, 500);
            }
        }

        function updateTimer() {
            if (!gameRunning || gamePaused) return;
            
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            document.getElementById('time').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateDisplay() {
            document.getElementById('foundWords').textContent = foundWords.length;
            document.getElementById('totalWords').textContent = words.length;
            document.getElementById('score').textContent = score;
        }

        function newGame() {
            gameRunning = true;
            gamePaused = false;
            startTime = Date.now();
            score = 0;
            
            initializeGrid();
            selectRandomWords();
            placeWordsInGrid();
            fillEmptyCells();
            
            renderGrid();
            renderWordList();
            
            // íƒ€ì´ë¨¸ ì‹œì‘
            clearInterval(gameTimer);
            gameTimer = setInterval(updateTimer, 1000);
            
            updateDisplay();
            document.getElementById('time').textContent = '00:00';
        }

        function pauseGame() {
            if (gameRunning) {
                gamePaused = !gamePaused;
            }
        }

        // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ë°©ì§€ (ë“œë˜ê·¸ ë°©ì§€)
        document.addEventListener('selectstart', e => e.preventDefault());

        // ì´ˆê¸°í™”
        newGame();
    </script>
</body>
</html>