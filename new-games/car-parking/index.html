<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš— ìë™ì°¨ ì£¼ì°¨ ê²Œì„</title>
    
    <!-- Google Analytics -->
    <script src="../../analytics.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #2C3E50, #3498DB);
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
        }
        
        .game-container {
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #3498DB;
        }
        
        canvas {
            border: 3px solid #2980B9;
            border-radius: 10px;
            background: #34495E;
        }
        
        .ui {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stat {
            background: rgba(52, 152, 219, 0.8);
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-weight: bold;
        }
        
        .controls {
            margin-top: 15px;
            font-size: 14px;
            color: #ccc;
        }
        
        .level-selector {
            margin: 10px 0;
        }
        
        .level-btn {
            background: #E74C3C;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 0 5px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .level-btn.active {
            background: #C0392B;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }
        
        .parking-status {
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
        }
        
        .parking-status.success {
            color: #27AE60;
        }
        
        .parking-status.fail {
            color: #E74C3C;
        }
        
        .restart-btn {
            background: #27AE60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s;
        }
        
        .restart-btn:hover {
            background: #229954;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸš— ìë™ì°¨ ì£¼ì°¨ ê²Œì„</h1>
        
        <div class="ui">
            <div class="stat">ğŸ¯ ë ˆë²¨: <span id="currentLevel">1</span></div>
            <div class="stat">ğŸ’¥ ì¶©ëŒ: <span id="crashes">0</span></div>
            <div class="stat">â±ï¸ ì‹œê°„: <span id="timer">00:00</span></div>
            <div class="stat">â­ ì ìˆ˜: <span id="score">0</span></div>
        </div>
        
        <div class="level-selector">
            <button class="level-btn active" onclick="selectLevel(1)">ë ˆë²¨ 1</button>
            <button class="level-btn" onclick="selectLevel(2)">ë ˆë²¨ 2</button>
            <button class="level-btn" onclick="selectLevel(3)">ë ˆë²¨ 3</button>
            <button class="level-btn" onclick="selectLevel(4)">ë ˆë²¨ 4</button>
        </div>
        
        <div class="parking-status" id="parkingStatus">ì£¼ì°¨ ê³µê°„ì— ìë™ì°¨ë¥¼ ì£¼ì°¨í•˜ì„¸ìš”!</div>
        
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <button class="restart-btn" onclick="restartLevel()">ğŸ”„ ë‹¤ì‹œ ì‹œì‘</button>
        
        <div class="controls">
            <p>ğŸ® ì¡°ì‘ë²•: í™”ì‚´í‘œ í‚¤ë¡œ ìë™ì°¨ë¥¼ ì¡°ì¢…í•˜ì„¸ìš”!</p>
            <p>ğŸš— â†‘â†“: ì „ì§„/í›„ì§„, â†â†’: ì¢ŒíšŒì „/ìš°íšŒì „</p>
            <p>ğŸ’¡ íŒ: ì²œì²œíˆ ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ì£¼ì°¨í•˜ì„¸ìš”! ë²½ì— ë¶€ë”ªíˆë©´ ì•ˆ ë¼ìš”!</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            currentLevel: 1,
            crashes: 0,
            score: 0,
            startTime: Date.now(),
            gameRunning: true,
            levelCompleted: false
        };
        
        // ìë™ì°¨
        const car = {
            x: 100,
            y: 500,
            width: 40,
            height: 20,
            angle: 0,
            speed: 0,
            maxSpeed: 3,
            turnSpeed: 0.05,
            friction: 0.95
        };
        
        // í‚¤ ì…ë ¥
        const keys = {};
        document.addEventListener('keydown', (e) => keys[e.key] = true);
        document.addEventListener('keyup', (e) => keys[e.key] = false);
        
        // ë ˆë²¨ ë°ì´í„°
        const levels = {
            1: {
                obstacles: [
                    { x: 0, y: 0, width: 800, height: 20 }, // ìƒë‹¨ ë²½
                    { x: 0, y: 580, width: 800, height: 20 }, // í•˜ë‹¨ ë²½
                    { x: 0, y: 0, width: 20, height: 600 }, // ì¢Œì¸¡ ë²½
                    { x: 780, y: 0, width: 20, height: 600 }, // ìš°ì¸¡ ë²½
                ],
                parkingSpot: { x: 650, y: 450, width: 100, height: 60 },
                startPos: { x: 100, y: 500, angle: 0 }
            },
            2: {
                obstacles: [
                    { x: 0, y: 0, width: 800, height: 20 },
                    { x: 0, y: 580, width: 800, height: 20 },
                    { x: 0, y: 0, width: 20, height: 600 },
                    { x: 780, y: 0, width: 20, height: 600 },
                    { x: 300, y: 200, width: 200, height: 20 }, // ì¤‘ê°„ ì¥ì• ë¬¼
                    { x: 400, y: 350, width: 20, height: 150 }
                ],
                parkingSpot: { x: 600, y: 100, width: 100, height: 60 },
                startPos: { x: 100, y: 500, angle: 0 }
            },
            3: {
                obstacles: [
                    { x: 0, y: 0, width: 800, height: 20 },
                    { x: 0, y: 580, width: 800, height: 20 },
                    { x: 0, y: 0, width: 20, height: 600 },
                    { x: 780, y: 0, width: 20, height: 600 },
                    { x: 200, y: 150, width: 20, height: 200 },
                    { x: 400, y: 250, width: 20, height: 200 },
                    { x: 600, y: 100, width: 20, height: 200 }
                ],
                parkingSpot: { x: 50, y: 50, width: 100, height: 60 },
                startPos: { x: 700, y: 500, angle: Math.PI }
            },
            4: {
                obstacles: [
                    { x: 0, y: 0, width: 800, height: 20 },
                    { x: 0, y: 580, width: 800, height: 20 },
                    { x: 0, y: 0, width: 20, height: 600 },
                    { x: 780, y: 0, width: 20, height: 600 },
                    { x: 150, y: 100, width: 100, height: 20 },
                    { x: 350, y: 200, width: 100, height: 20 },
                    { x: 550, y: 300, width: 100, height: 20 },
                    { x: 250, y: 400, width: 300, height: 20 }
                ],
                parkingSpot: { x: 350, y: 50, width: 100, height: 60 },
                startPos: { x: 100, y: 300, angle: Math.PI / 2 }
            }
        };
        
        // ë ˆë²¨ ì„ íƒ
        function selectLevel(level) {
            gameState.currentLevel = level;
            document.querySelectorAll('.level-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            loadLevel();
        }
        
        // ë ˆë²¨ ë¡œë“œ
        function loadLevel() {
            const level = levels[gameState.currentLevel];
            car.x = level.startPos.x;
            car.y = level.startPos.y;
            car.angle = level.startPos.angle;
            car.speed = 0;
            gameState.crashes = 0;
            gameState.startTime = Date.now();
            gameState.levelCompleted = false;
            gameState.gameRunning = true;
            
            document.getElementById('parkingStatus').textContent = 'ì£¼ì°¨ ê³µê°„ì— ìë™ì°¨ë¥¼ ì£¼ì°¨í•˜ì„¸ìš”!';
            document.getElementById('parkingStatus').className = 'parking-status';
        }
        
        // ë ˆë²¨ ì¬ì‹œì‘
        function restartLevel() {
            loadLevel();
        }
        
        // ì¶©ëŒ ê°ì§€
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }
        
        // ìë™ì°¨ ëª¨ì„œë¦¬ ê³„ì‚°
        function getCarCorners() {
            const cos = Math.cos(car.angle);
            const sin = Math.sin(car.angle);
            const halfWidth = car.width / 2;
            const halfHeight = car.height / 2;
            
            return [
                {
                    x: car.x + cos * (-halfWidth) - sin * (-halfHeight),
                    y: car.y + sin * (-halfWidth) + cos * (-halfHeight)
                },
                {
                    x: car.x + cos * (halfWidth) - sin * (-halfHeight),
                    y: car.y + sin * (halfWidth) + cos * (-halfHeight)
                },
                {
                    x: car.x + cos * (halfWidth) - sin * (halfHeight),
                    y: car.y + sin * (halfWidth) + cos * (halfHeight)
                },
                {
                    x: car.x + cos * (-halfWidth) - sin * (halfHeight),
                    y: car.y + sin * (-halfWidth) + cos * (halfHeight)
                }
            ];
        }
        
        // ì ì´ ì‚¬ê°í˜• ì•ˆì— ìˆëŠ”ì§€ í™•ì¸
        function pointInRect(point, rect) {
            return point.x >= rect.x && point.x <= rect.x + rect.width &&
                   point.y >= rect.y && point.y <= rect.y + rect.height;
        }
        
        // ì—…ë°ì´íŠ¸
        function update() {
            if (!gameState.gameRunning || gameState.levelCompleted) return;
            
            const level = levels[gameState.currentLevel];
            
            // ìë™ì°¨ ì¡°ì‘
            if (keys['ArrowUp']) {
                car.speed = Math.min(car.speed + 0.2, car.maxSpeed);
            } else if (keys['ArrowDown']) {
                car.speed = Math.max(car.speed - 0.2, -car.maxSpeed);
            } else {
                car.speed *= car.friction;
            }
            
            if (keys['ArrowLeft']) {
                car.angle -= car.turnSpeed * Math.abs(car.speed);
            }
            if (keys['ArrowRight']) {
                car.angle += car.turnSpeed * Math.abs(car.speed);
            }
            
            // ìë™ì°¨ ì´ë™
            car.x += Math.cos(car.angle) * car.speed;
            car.y += Math.sin(car.angle) * car.speed;
            
            // ì¶©ëŒ ê°ì§€
            const carCorners = getCarCorners();
            let collision = false;
            
            level.obstacles.forEach(obstacle => {
                carCorners.forEach(corner => {
                    if (pointInRect(corner, obstacle)) {
                        collision = true;
                    }
                });
            });
            
            if (collision) {
                // ì¶©ëŒ ì‹œ ìë™ì°¨ë¥¼ ì´ì „ ìœ„ì¹˜ë¡œ ë˜ëŒë¦¬ê¸°
                car.x -= Math.cos(car.angle) * car.speed;
                car.y -= Math.sin(car.angle) * car.speed;
                car.speed = 0;
                gameState.crashes++;
            }
            
            // ì£¼ì°¨ ì™„ë£Œ ì²´í¬
            const parkingSpot = level.parkingSpot;
            let inParkingSpot = true;
            
            carCorners.forEach(corner => {
                if (!pointInRect(corner, parkingSpot)) {
                    inParkingSpot = false;
                }
            });
            
            if (inParkingSpot && Math.abs(car.speed) < 0.1) {
                gameState.levelCompleted = true;
                const timeBonus = Math.max(0, 30 - Math.floor((Date.now() - gameState.startTime) / 1000));
                const crashPenalty = gameState.crashes * 10;
                gameState.score += Math.max(0, 100 + timeBonus - crashPenalty);
                
                document.getElementById('parkingStatus').textContent = 'ğŸ‰ ì£¼ì°¨ ì™„ë£Œ!';
                document.getElementById('parkingStatus').className = 'parking-status success';
                
                setTimeout(() => {
                    if (gameState.currentLevel < 4) {
                        if (confirm('ë‹¤ìŒ ë ˆë²¨ë¡œ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            selectLevel(gameState.currentLevel + 1);
                        }
                    } else {
                        alert(`ëª¨ë“  ë ˆë²¨ ì™„ë£Œ!\nìµœì¢… ì ìˆ˜: ${gameState.score}ì `);
                    }
                }, 1000);
            }
            
            updateUI();
        }
        
        // ë Œë”ë§
        function render() {
            // ë°°ê²½
            ctx.fillStyle = '#2C3E50';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ë„ë¡œ í‘œì‹œ
            ctx.fillStyle = '#34495E';
            ctx.fillRect(20, 20, canvas.width - 40, canvas.height - 40);
            
            // ë„ë¡œ ì„ 
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 10]);
            
            // ê°€ë¡œì„ 
            for (let y = 100; y < canvas.height; y += 100) {
                ctx.beginPath();
                ctx.moveTo(20, y);
                ctx.lineTo(canvas.width - 20, y);
                ctx.stroke();
            }
            
            // ì„¸ë¡œì„ 
            for (let x = 100; x < canvas.width; x += 100) {
                ctx.beginPath();
                ctx.moveTo(x, 20);
                ctx.lineTo(x, canvas.height - 20);
                ctx.stroke();
            }
            
            ctx.setLineDash([]);
            
            const level = levels[gameState.currentLevel];
            
            // ì¥ì• ë¬¼
            ctx.fillStyle = '#7F8C8D';
            level.obstacles.forEach(obstacle => {
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            });
            
            // ì£¼ì°¨ ê³µê°„
            const parkingSpot = level.parkingSpot;
            ctx.fillStyle = 'rgba(46, 204, 113, 0.3)';
            ctx.fillRect(parkingSpot.x, parkingSpot.y, parkingSpot.width, parkingSpot.height);
            
            ctx.strokeStyle = '#27AE60';
            ctx.lineWidth = 3;
            ctx.strokeRect(parkingSpot.x, parkingSpot.y, parkingSpot.width, parkingSpot.height);
            
            // ì£¼ì°¨ í‘œì‹œ
            ctx.fillStyle = '#27AE60';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ…¿ï¸', parkingSpot.x + parkingSpot.width / 2, parkingSpot.y + parkingSpot.height / 2 + 5);
            
            // ìë™ì°¨
            ctx.save();
            ctx.translate(car.x, car.y);
            ctx.rotate(car.angle);
            
            // ìë™ì°¨ ê·¸ë¦¼ì
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.fillRect(-car.width / 2 + 2, -car.height / 2 + 2, car.width, car.height);
            
            // ìë™ì°¨ ëª¸ì²´
            ctx.fillStyle = '#E74C3C';
            ctx.fillRect(-car.width / 2, -car.height / 2, car.width, car.height);
            
            // ìë™ì°¨ ì°½ë¬¸
            ctx.fillStyle = '#3498DB';
            ctx.fillRect(-car.width / 2 + 5, -car.height / 2 + 3, car.width - 10, car.height - 6);
            
            // ìë™ì°¨ ë°©í–¥ í‘œì‹œ
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(car.width / 2 - 3, -2, 6, 4);
            
            ctx.restore();
            
            // ìë™ì°¨ ê¶¤ì  (ì†ë„ì— ë”°ë¼)
            if (Math.abs(car.speed) > 0.1) {
                ctx.strokeStyle = 'rgba(231, 76, 60, 0.3)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(car.x, car.y, 30, 0, Math.PI * 2);
                ctx.stroke();
            }
        }
        
        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            document.getElementById('currentLevel').textContent = gameState.currentLevel;
            document.getElementById('crashes').textContent = gameState.crashes;
            document.getElementById('score').textContent = gameState.score;
            
            // íƒ€ì´ë¨¸
            const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }
        
        // ê²Œì„ ì‹œì‘
        loadLevel();
        gameLoop();
    </script>
</body>
</html>