<!DOCTYPE html>
<html>
<head>
    <title>ë„ì‹œ ê±´ì„¤ ê²Œì„</title>
    
    <!-- Google Analytics -->
    <script src="../../analytics.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            text-align: center;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        h1 {
            font-size: 3rem;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            margin-bottom: 20px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .game-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        canvas {
            border: 4px solid #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            background: #90EE90;
            cursor: pointer;
        }
        
        .game-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            min-width: 250px;
        }
        
        .info-item {
            margin: 15px 0;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .building-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .building-btn {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .building-btn:hover {
            transform: scale(1.05);
        }
        
        .building-btn.selected {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        .building-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        button {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 600px;
            backdrop-filter: blur(5px);
        }
        
        #secretMessage {
            display: none;
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <h1>ğŸ™ï¸ ë„ì‹œ ê±´ì„¤</h1>
    
    <div class="instructions">
        <p><strong>ğŸ® ê²Œì„ ë°©ë²•:</strong></p>
        <p>ê±´ë¬¼ì„ ì„ íƒí•˜ê³  ë§µì— í´ë¦­í•´ì„œ ë„ì‹œë¥¼ ê±´ì„¤í•˜ì„¸ìš”!</p>
        <p>ì£¼ë¯¼ë“¤ì´ í–‰ë³µí•˜ë„ë¡ ê· í˜•ìˆê²Œ ê±´ì„¤í•˜ì„¸ìš”!</p>
        <p>ëˆì„ ê´€ë¦¬í•˜ë©´ì„œ ë„ì‹œë¥¼ ë°œì „ì‹œì¼œë³´ì„¸ìš”!</p>
        <p>ğŸ’– ë¹„ë°€: "ì„œë¯¼ì¬ì‚¬ë‘í•´"ë¥¼ ì…ë ¥í•˜ë©´ íŠ¹ë³„í•œ ì¼ì´...?</p>
    </div>
    
    <div class="game-container">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        
        <div class="game-info">
            <div class="info-item">ğŸ’° ëˆ: $<span id="money">1000</span></div>
            <div class="info-item">ğŸ‘¥ ì¸êµ¬: <span id="population">0</span></div>
            <div class="info-item">ğŸ˜Š í–‰ë³µë„: <span id="happiness">50</span>%</div>
            
            <div class="stats-grid">
                <div>ğŸ  ì£¼íƒ: <span id="houses">0</span></div>
                <div>ğŸ¢ ìƒì : <span id="shops">0</span></div>
                <div>ğŸ­ ê³µì¥: <span id="factories">0</span></div>
                <div>ğŸŒ³ ê³µì›: <span id="parks">0</span></div>
            </div>
            
            <div class="building-buttons">
                <button class="building-btn" onclick="selectBuilding('house')">ğŸ  ì£¼íƒ ($100)</button>
                <button class="building-btn" onclick="selectBuilding('shop')">ğŸ¢ ìƒì  ($200)</button>
                <button class="building-btn" onclick="selectBuilding('factory')">ğŸ­ ê³µì¥ ($300)</button>
                <button class="building-btn" onclick="selectBuilding('park')">ğŸŒ³ ê³µì› ($150)</button>
                <button class="building-btn" onclick="selectBuilding('road')">ğŸ›£ï¸ ë„ë¡œ ($50)</button>
                <button class="building-btn" onclick="selectBuilding('demolish')">ğŸ’¥ ì² ê±° (ë¬´ë£Œ)</button>
            </div>
            
            <div id="secretMessage">
                ğŸ’– ë¹„ë°€ ì•”í˜¸ í™œì„±í™”!<br>ë¬´í•œ ìê¸ˆ ëª¨ë“œ ON! ğŸ’–
            </div>
            
            <button onclick="resetGame()">ìƒˆ ë„ì‹œ</button>
            <button onclick="saveCity()">ë„ì‹œ ì €ì¥</button>
        </div>
    </div>

    <script>
        // ìº”ë²„ìŠ¤ ì„¤ì •
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ê²Œì„ ìƒíƒœ
        let money = 1000;
        let population = 0;
        let happiness = 50;
        let selectedBuilding = null;
        
        // ë¹„ë°€ ì•”í˜¸ ê´€ë ¨ ë³€ìˆ˜
        let secretMode = false;
        let secretInput = '';
        const secretPassword = 'ì„œë¯¼ì¬ì‚¬ë‘í•´';
        
        // ê·¸ë¦¬ë“œ ì„¤ì •
        const gridSize = 40;
        const gridWidth = canvas.width / gridSize;
        const gridHeight = canvas.height / gridSize;
        
        // ë„ì‹œ ê·¸ë¦¬ë“œ
        let cityGrid = [];
        
        // ê±´ë¬¼ íƒ€ì…ë“¤
        const buildingTypes = {
            house: { cost: 100, emoji: 'ğŸ ', income: 20, population: 4, happiness: 0 },
            shop: { cost: 200, emoji: 'ğŸ¢', income: 50, population: 0, happiness: 10 },
            factory: { cost: 300, emoji: 'ğŸ­', income: 100, population: 0, happiness: -20 },
            park: { cost: 150, emoji: 'ğŸŒ³', income: 0, population: 0, happiness: 30 },
            road: { cost: 50, emoji: 'ğŸ›£ï¸', income: 0, population: 0, happiness: 5 }
        };
        
        // ê±´ë¬¼ ì¹´ìš´íŠ¸
        let buildingCounts = {
            house: 0,
            shop: 0,
            factory: 0,
            park: 0,
            road: 0
        };
        
        // íŒŒí‹°í´ ì‹œìŠ¤í…œ
        let particles = [];
        
        // ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
        function initializeGrid() {
            cityGrid = [];
            for (let y = 0; y < gridHeight; y++) {
                cityGrid[y] = [];
                for (let x = 0; x < gridWidth; x++) {
                    cityGrid[y][x] = null;
                }
            }
        }
        
        // íŒŒí‹°í´ íš¨ê³¼
        function createBuildParticles(x, y) {
            for (let i = 0; i < 8; i++) {
                particles.push({
                    x: x * gridSize + gridSize/2,
                    y: y * gridSize + gridSize/2,
                    vx: (Math.random() - 0.5) * 6,
                    vy: Math.random() * -4 - 2,
                    life: 30,
                    color: secretMode ? '#ffd700' : '#2ecc71'
                });
            }
        }
        
        function createMoneyParticles(x, y) {
            for (let i = 0; i < 5; i++) {
                particles.push({
                    x: x * gridSize + gridSize/2,
                    y: y * gridSize + gridSize/2,
                    vx: (Math.random() - 0.5) * 4,
                    vy: Math.random() * -3 - 1,
                    life: 40,
                    color: '#ffd700',
                    text: '$'
                });
            }
        }
        
        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2;
                p.life--;
                
                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }
        
        // ì´ˆê¸°í™”
        initializeGrid();
        
        // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
        canvas.addEventListener('click', (e) => {
            if (!selectedBuilding) return;
            
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const gridX = Math.floor(mouseX / gridSize);
            const gridY = Math.floor(mouseY / gridSize);
            
            if (gridX >= 0 && gridX < gridWidth && gridY >= 0 && gridY < gridHeight) {
                if (selectedBuilding === 'demolish') {
                    demolishBuilding(gridX, gridY);
                } else {
                    buildBuilding(gridX, gridY, selectedBuilding);
                }
            }
        });
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (ë¹„ë°€ ì•”í˜¸)
        document.addEventListener('keydown', (e) => {
            if (e.key.length === 1) {
                secretInput += e.key;
                if (secretInput.length > secretPassword.length) {
                    secretInput = secretInput.slice(-secretPassword.length);
                }
                
                if (secretInput === secretPassword) {
                    secretMode = !secretMode;
                    document.getElementById('secretMessage').style.display = secretMode ? 'block' : 'none';
                    secretInput = '';
                    
                    if (secretMode) {
                        money = 999999; // ë¬´í•œ ìê¸ˆ
                        updateDisplay();
                    }
                }
            }
        });
        
        function selectBuilding(type) {
            selectedBuilding = selectedBuilding === type ? null : type;
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.building-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            if (selectedBuilding) {
                event.target.classList.add('selected');
            }
        }
        
        function buildBuilding(x, y, type) {
            // ì´ë¯¸ ê±´ë¬¼ì´ ìˆëŠ”ì§€ í™•ì¸
            if (cityGrid[y][x] !== null) return;
            
            const building = buildingTypes[type];
            if (!building) return;
            
            // ëˆ í™•ì¸
            if (!secretMode && money < building.cost) return;
            
            // ê±´ë¬¼ ê±´ì„¤
            cityGrid[y][x] = type;
            if (!secretMode) money -= building.cost;
            buildingCounts[type]++;
            
            // íš¨ê³¼
            createBuildParticles(x, y);
            
            updateStats();
            updateDisplay();
        }
        
        function demolishBuilding(x, y) {
            const buildingType = cityGrid[y][x];
            if (buildingType === null) return;
            
            // ê±´ë¬¼ ì² ê±°
            cityGrid[y][x] = null;
            buildingCounts[buildingType]--;
            
            // ì¼ë¶€ ë¹„ìš© í™˜ë¶ˆ
            const refund = Math.floor(buildingTypes[buildingType].cost * 0.5);
            money += refund;
            
            updateStats();
            updateDisplay();
        }
        
        function updateStats() {
            // ì¸êµ¬ ê³„ì‚°
            population = 0;
            happiness = 50; // ê¸°ë³¸ í–‰ë³µë„
            
            for (let y = 0; y < gridHeight; y++) {
                for (let x = 0; x < gridWidth; x++) {
                    const buildingType = cityGrid[y][x];
                    if (buildingType && buildingTypes[buildingType]) {
                        const building = buildingTypes[buildingType];
                        population += building.population;
                        happiness += building.happiness;
                    }
                }
            }
            
            // í–‰ë³µë„ ì œí•œ
            happiness = Math.max(0, Math.min(100, happiness));
            
            // ìˆ˜ì… ê³„ì‚° (ë§¤ ì´ˆë§ˆë‹¤)
            if (Date.now() % 1000 < 50) { // ëŒ€ëµ 1ì´ˆë§ˆë‹¤
                let income = 0;
                for (let y = 0; y < gridHeight; y++) {
                    for (let x = 0; x < gridWidth; x++) {
                        const buildingType = cityGrid[y][x];
                        if (buildingType && buildingTypes[buildingType]) {
                            income += buildingTypes[buildingType].income;
                            
                            // ìˆ˜ì… íŒŒí‹°í´
                            if (buildingTypes[buildingType].income > 0 && Math.random() < 0.1) {
                                createMoneyParticles(x, y);
                            }
                        }
                    }
                }
                
                // í–‰ë³µë„ì— ë”°ë¥¸ ìˆ˜ì… ë³´ë„ˆìŠ¤
                const happinessMultiplier = happiness / 100;
                income = Math.floor(income * happinessMultiplier);
                
                if (secretMode) income *= 2; // ë¹„ë°€ ëª¨ë“œì—ì„œëŠ” 2ë°° ìˆ˜ì…
                
                money += income;
            }
        }
        
        function updateDisplay() {
            document.getElementById('money').textContent = money;
            document.getElementById('population').textContent = population;
            document.getElementById('happiness').textContent = Math.floor(happiness);
            
            document.getElementById('houses').textContent = buildingCounts.house;
            document.getElementById('shops').textContent = buildingCounts.shop;
            document.getElementById('factories').textContent = buildingCounts.factory;
            document.getElementById('parks').textContent = buildingCounts.park;
            
            // ê±´ë¬¼ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            document.querySelectorAll('.building-btn').forEach(btn => {
                const buildingType = btn.onclick.toString().match(/'(\w+)'/);
                if (buildingType && buildingType[1] !== 'demolish') {
                    const cost = buildingTypes[buildingType[1]]?.cost || 0;
                    btn.disabled = !secretMode && money < cost;
                }
            });
        }
        
        function resetGame() {
            money = 1000;
            population = 0;
            happiness = 50;
            selectedBuilding = null;
            
            buildingCounts = {
                house: 0,
                shop: 0,
                factory: 0,
                park: 0,
                road: 0
            };
            
            initializeGrid();
            particles = [];
            
            document.querySelectorAll('.building-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            updateDisplay();
        }
        
        function saveCity() {
            const cityData = {
                grid: cityGrid,
                money: money,
                population: population,
                happiness: happiness,
                buildingCounts: buildingCounts
            };
            
            localStorage.setItem('cityBuilderSave', JSON.stringify(cityData));
            alert('ë„ì‹œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function loadCity() {
            const savedData = localStorage.getItem('cityBuilderSave');
            if (savedData) {
                const cityData = JSON.parse(savedData);
                cityGrid = cityData.grid;
                money = cityData.money;
                population = cityData.population;
                happiness = cityData.happiness;
                buildingCounts = cityData.buildingCounts;
                
                updateDisplay();
            }
        }
        
        function draw() {
            // ë°°ê²½ ê·¸ë¦¬ê¸°
            ctx.fillStyle = secretMode ? '#1a1a2e' : '#90EE90';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ê·¸ë¦¬ë“œ ì„  ê·¸ë¦¬ê¸°
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // ê±´ë¬¼ë“¤ ê·¸ë¦¬ê¸°
            for (let y = 0; y < gridHeight; y++) {
                for (let x = 0; x < gridWidth; x++) {
                    const buildingType = cityGrid[y][x];
                    if (buildingType && buildingTypes[buildingType]) {
                        const building = buildingTypes[buildingType];
                        
                        // ê±´ë¬¼ ë°°ê²½
                        if (buildingType === 'road') {
                            ctx.fillStyle = secretMode ? '#ffd700' : '#696969';
                        } else {
                            ctx.fillStyle = secretMode ? '#ff6b6b' : 'rgba(255, 255, 255, 0.8)';
                        }
                        ctx.fillRect(x * gridSize + 2, y * gridSize + 2, gridSize - 4, gridSize - 4);
                        
                        // ê±´ë¬¼ ì´ëª¨ì§€
                        ctx.font = '24px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(
                            building.emoji,
                            x * gridSize + gridSize/2,
                            y * gridSize + gridSize/2 + 8
                        );
                    }
                }
            }
            
            // ì„ íƒëœ ê±´ë¬¼ ë¯¸ë¦¬ë³´ê¸°
            if (selectedBuilding && selectedBuilding !== 'demolish') {
                const mousePos = getMouseGridPosition();
                if (mousePos && cityGrid[mousePos.y][mousePos.x] === null) {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.fillRect(
                        mousePos.x * gridSize + 2,
                        mousePos.y * gridSize + 2,
                        gridSize - 4,
                        gridSize - 4
                    );
                    
                    const building = buildingTypes[selectedBuilding];
                    ctx.font = '24px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(
                        building.emoji,
                        mousePos.x * gridSize + gridSize/2,
                        mousePos.y * gridSize + gridSize/2 + 8
                    );
                }
            }
            
            // íŒŒí‹°í´ ê·¸ë¦¬ê¸°
            for (let p of particles) {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / 40;
                
                if (p.text) {
                    ctx.font = '16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(p.text, p.x, p.y);
                } else {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            ctx.globalAlpha = 1;
            
            // í–‰ë³µë„ í‘œì‹œ
            const happinessColor = happiness > 70 ? '#2ecc71' : happiness > 40 ? '#f39c12' : '#e74c3c';
            ctx.fillStyle = happinessColor;
            ctx.fillRect(10, 10, (happiness / 100) * 200, 10);
            
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.strokeRect(10, 10, 200, 10);
            
            ctx.fillStyle = '#fff';
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`í–‰ë³µë„: ${Math.floor(happiness)}%`, 10, 35);
        }
        
        function getMouseGridPosition() {
            // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ë¥¼ ê·¸ë¦¬ë“œ ì¢Œí‘œë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ì—ì„œ ê³„ì‚°
            return null;
        }
        
        function gameLoop() {
            updateStats();
            updateParticles();
            draw();
            updateDisplay();
            requestAnimationFrame(gameLoop);
        }
        
        // ê²Œì„ ì‹œì‘
        loadCity(); // ì €ì¥ëœ ë„ì‹œ ë¡œë“œ ì‹œë„
        updateDisplay();
        gameLoop();
    </script>
</body>
</html>