<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ í’ì„  í„°ëœ¨ë¦¬ê¸°</title>
    
    <!-- Google Analytics -->
    <script src="../../analytics.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #87CEEB, #98FB98);
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
        }
        
        .game-container {
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #FF69B4;
        }
        
        canvas {
            border: 3px solid #FF1493;
            border-radius: 10px;
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 100%);
            cursor: crosshair;
        }
        
        .ui {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stat {
            background: rgba(255, 105, 180, 0.8);
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-weight: bold;
        }
        
        .controls {
            margin-top: 15px;
            font-size: 14px;
            color: #ccc;
        }
        
        .power-ups {
            margin: 10px 0;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .power-up {
            background: #9370DB;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .power-up:hover {
            background: #8A2BE2;
            transform: scale(1.05);
        }
        
        .power-up:disabled {
            background: #555;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ¯ í’ì„  í„°ëœ¨ë¦¬ê¸°</h1>
        
        <div class="ui">
            <div class="stat">ğŸˆ í„°ëœ¨ë¦° í’ì„ : <span id="popped">0</span></div>
            <div class="stat">â­ ì ìˆ˜: <span id="score">0</span></div>
            <div class="stat">â° ì‹œê°„: <span id="timeLeft">60</span>ì´ˆ</div>
            <div class="stat">ğŸ”¥ ì½¤ë³´: <span id="combo">0</span></div>
        </div>
        
        <div class="power-ups">
            <button class="power-up" onclick="usePowerUp('slowTime')" id="slowTimeBtn">â° ì‹œê°„ ëŠë¦¬ê²Œ</button>
            <button class="power-up" onclick="usePowerUp('multiPop')" id="multiPopBtn">ğŸ’¥ ì—°ì‡„ í„°ëœ¨ë¦¬ê¸°</button>
            <button class="power-up" onclick="usePowerUp('bigBalloons')" id="bigBalloonsBtn">ğŸˆ í° í’ì„ </button>
        </div>
        
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="controls">
            <p>ğŸ® ì¡°ì‘ë²•: ë§ˆìš°ìŠ¤ë¡œ í’ì„ ì„ í´ë¦­í•´ì„œ í„°ëœ¨ë¦¬ì„¸ìš”!</p>
            <p>ğŸ’¡ íŒ: ì—°ì†ìœ¼ë¡œ í„°ëœ¨ë¦¬ë©´ ì½¤ë³´ ë³´ë„ˆìŠ¤ë¥¼ ë°›ì„ ìˆ˜ ìˆì–´ìš”!</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            popped: 0,
            score: 0,
            timeLeft: 60,
            combo: 0,
            comboTimer: 0,
            gameRunning: true,
            slowMotion: false,
            multiPop: false,
            bigBalloons: false
        };
        
        // í’ì„ ë“¤
        let balloons = [];
        let particles = [];
        
        // í’ì„  ìƒ‰ê¹”ë“¤
        const balloonColors = ['#FF69B4', '#FF6347', '#FFD700', '#32CD32', '#1E90FF', '#9370DB', '#FF4500'];
        
        // íŒŒì›Œì—… ì¿¨ë‹¤ìš´
        const powerUps = {
            slowTime: { cooldown: 0, maxCooldown: 900 },
            multiPop: { cooldown: 0, maxCooldown: 600 },
            bigBalloons: { cooldown: 0, maxCooldown: 450 }
        };
        
        // í’ì„  ìƒì„±
        function createBalloon() {
            const size = gameState.bigBalloons ? 
                Math.random() * 40 + 40 : 
                Math.random() * 30 + 20;
            
            balloons.push({
                x: Math.random() * (canvas.width - size * 2) + size,
                y: canvas.height + size,
                size: size,
                color: balloonColors[Math.floor(Math.random() * balloonColors.length)],
                speed: Math.random() * 2 + 1,
                wobble: Math.random() * 0.02 + 0.01,
                wobbleOffset: Math.random() * Math.PI * 2,
                points: Math.floor(size / 5) + 5
            });
        }
        
        // íŒŒì›Œì—… ì‚¬ìš©
        function usePowerUp(type) {
            if (powerUps[type].cooldown > 0) return;
            
            switch(type) {
                case 'slowTime':
                    gameState.slowMotion = true;
                    setTimeout(() => gameState.slowMotion = false, 5000);
                    powerUps.slowTime.cooldown = powerUps.slowTime.maxCooldown;
                    break;
                    
                case 'multiPop':
                    gameState.multiPop = true;
                    setTimeout(() => gameState.multiPop = false, 8000);
                    powerUps.multiPop.cooldown = powerUps.multiPop.maxCooldown;
                    break;
                    
                case 'bigBalloons':
                    gameState.bigBalloons = true;
                    setTimeout(() => gameState.bigBalloons = false, 10000);
                    powerUps.bigBalloons.cooldown = powerUps.bigBalloons.maxCooldown;
                    break;
            }
        }
        
        // íŒŒí‹°í´ ìƒì„±
        function createParticles(x, y, color, count = 8) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 30,
                    maxLife: 30,
                    color: color,
                    size: Math.random() * 4 + 2
                });
            }
        }
        
        // í’ì„  í„°ëœ¨ë¦¬ê¸°
        function popBalloon(index) {
            const balloon = balloons[index];
            
            // íŒŒí‹°í´ íš¨ê³¼
            createParticles(balloon.x, balloon.y, balloon.color);
            
            // ì ìˆ˜ ê³„ì‚°
            let points = balloon.points;
            if (gameState.combo > 0) {
                points *= (1 + gameState.combo * 0.1);
            }
            
            gameState.score += Math.floor(points);
            gameState.popped++;
            gameState.combo++;
            gameState.comboTimer = 120; // 2ì´ˆ
            
            // ì—°ì‡„ í„°ëœ¨ë¦¬ê¸°
            if (gameState.multiPop) {
                balloons.forEach((otherBalloon, otherIndex) => {
                    if (otherIndex !== index) {
                        const distance = Math.sqrt(
                            (balloon.x - otherBalloon.x) ** 2 + 
                            (balloon.y - otherBalloon.y) ** 2
                        );
                        if (distance < 100) {
                            setTimeout(() => {
                                if (balloons[otherIndex]) {
                                    popBalloon(otherIndex);
                                }
                            }, 200);
                        }
                    }
                });
            }
            
            balloons.splice(index, 1);
        }
        
        // ë§ˆìš°ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸
        canvas.addEventListener('click', (e) => {
            if (!gameState.gameRunning) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // í´ë¦­í•œ ìœ„ì¹˜ì˜ í’ì„  ì°¾ê¸°
            for (let i = balloons.length - 1; i >= 0; i--) {
                const balloon = balloons[i];
                const distance = Math.sqrt((x - balloon.x) ** 2 + (y - balloon.y) ** 2);
                
                if (distance <= balloon.size) {
                    popBalloon(i);
                    break;
                }
            }
        });
        
        // ì—…ë°ì´íŠ¸
        function update() {
            if (!gameState.gameRunning) return;
            
            const timeMultiplier = gameState.slowMotion ? 0.3 : 1;
            
            // í’ì„  ìƒì„±
            if (Math.random() < 0.03 * timeMultiplier) {
                createBalloon();
            }
            
            // í’ì„  ì—…ë°ì´íŠ¸
            balloons.forEach((balloon, index) => {
                balloon.y -= balloon.speed * timeMultiplier;
                balloon.x += Math.sin(Date.now() * balloon.wobble + balloon.wobbleOffset) * 0.5;
                
                // í™”ë©´ ìœ„ë¡œ ì‚¬ë¼ì§„ í’ì„  ì œê±°
                if (balloon.y + balloon.size < 0) {
                    balloons.splice(index, 1);
                }
            });
            
            // íŒŒí‹°í´ ì—…ë°ì´íŠ¸
            particles.forEach((particle, index) => {
                particle.x += particle.vx * timeMultiplier;
                particle.y += particle.vy * timeMultiplier;
                particle.vx *= 0.95;
                particle.vy *= 0.95;
                particle.life--;
                
                if (particle.life <= 0) {
                    particles.splice(index, 1);
                }
            });
            
            // ì½¤ë³´ íƒ€ì´ë¨¸
            if (gameState.comboTimer > 0) {
                gameState.comboTimer--;
                if (gameState.comboTimer <= 0) {
                    gameState.combo = 0;
                }
            }
            
            // íŒŒì›Œì—… ì¿¨ë‹¤ìš´
            Object.keys(powerUps).forEach(key => {
                if (powerUps[key].cooldown > 0) {
                    powerUps[key].cooldown--;
                }
            });
            
            updateUI();
        }
        
        // ë Œë”ë§
        function render() {
            // ë°°ê²½ ê·¸ë¼ë””ì–¸íŠ¸
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#98FB98');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // êµ¬ë¦„ë“¤
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            for (let i = 0; i < 5; i++) {
                const x = (i * 200 + Date.now() * 0.02) % (canvas.width + 100) - 50;
                const y = 50 + i * 30;
                
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.arc(x + 25, y, 25, 0, Math.PI * 2);
                ctx.arc(x + 50, y, 20, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // í’ì„ ë“¤
            balloons.forEach(balloon => {
                // í’ì„  ê·¸ë¦¼ì
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                ctx.beginPath();
                ctx.ellipse(balloon.x + 5, balloon.y + 5, balloon.size * 0.8, balloon.size, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // í’ì„  ëª¸ì²´
                ctx.fillStyle = balloon.color;
                ctx.beginPath();
                ctx.arc(balloon.x, balloon.y, balloon.size, 0, Math.PI * 2);
                ctx.fill();
                
                // í’ì„  í•˜ì´ë¼ì´íŠ¸
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.beginPath();
                ctx.arc(balloon.x - balloon.size * 0.3, balloon.y - balloon.size * 0.3, balloon.size * 0.2, 0, Math.PI * 2);
                ctx.fill();
                
                // í’ì„  ëˆ
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(balloon.x, balloon.y + balloon.size);
                ctx.lineTo(balloon.x, balloon.y + balloon.size + 30);
                ctx.stroke();
            });
            
            // íŒŒí‹°í´
            particles.forEach(particle => {
                const alpha = particle.life / particle.maxLife;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
            
            // ìŠ¬ë¡œìš° ëª¨ì…˜ íš¨ê³¼
            if (gameState.slowMotion) {
                ctx.fillStyle = 'rgba(0, 100, 255, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            // ë©€í‹°íŒ íš¨ê³¼
            if (gameState.multiPop) {
                ctx.strokeStyle = 'rgba(255, 215, 0, 0.5)';
                ctx.lineWidth = 3;
                ctx.setLineDash([5, 5]);
                ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
                ctx.setLineDash([]);
            }
        }
        
        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            document.getElementById('popped').textContent = gameState.popped;
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('timeLeft').textContent = gameState.timeLeft;
            document.getElementById('combo').textContent = gameState.combo;
            
            // íŒŒì›Œì—… ë²„íŠ¼ ìƒíƒœ
            document.getElementById('slowTimeBtn').disabled = powerUps.slowTime.cooldown > 0;
            document.getElementById('multiPopBtn').disabled = powerUps.multiPop.cooldown > 0;
            document.getElementById('bigBalloonsBtn').disabled = powerUps.bigBalloons.cooldown > 0;
        }
        
        // íƒ€ì´ë¨¸
        setInterval(() => {
            if (gameState.gameRunning && gameState.timeLeft > 0) {
                gameState.timeLeft--;
                if (gameState.timeLeft <= 0) {
                    gameState.gameRunning = false;
                    setTimeout(() => {
                        alert(`ê²Œì„ ì¢…ë£Œ!\ní„°ëœ¨ë¦° í’ì„ : ${gameState.popped}ê°œ\nìµœì¢… ì ìˆ˜: ${gameState.score}ì `);
                    }, 500);
                }
            }
        }, 1000);
        
        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }
        
        // ê²Œì„ ì‹œì‘
        gameLoop();
    </script>
</body>
</html>