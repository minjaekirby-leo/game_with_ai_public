<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª í™”í•™ ì‹¤í—˜ì‹¤</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #2C3E50, #34495E);
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
        }
        
        .game-container {
            text-align: center;
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #3498DB;
            max-width: 1000px;
        }
        
        .lab-area {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        
        canvas {
            border: 3px solid #2980B9;
            border-radius: 10px;
            background: linear-gradient(180deg, #ECF0F1 0%, #BDC3C7 100%);
        }
        
        .sidebar {
            width: 250px;
            background: rgba(52, 73, 94, 0.3);
            border-radius: 10px;
            padding: 15px;
        }
        
        .ui {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stat {
            background: rgba(52, 152, 219, 0.8);
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-weight: bold;
        }
        
        .element-panel {
            margin-bottom: 20px;
        }
        
        .element-btn {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 10px;
            background: #3498DB;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .element-btn:hover {
            background: #2980B9;
            transform: scale(1.02);
        }
        
        .element-btn.selected {
            background: #E74C3C;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }
        
        .reaction-log {
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 8px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 12px;
            text-align: left;
        }
        
        .controls {
            margin-top: 15px;
            font-size: 14px;
            color: #ccc;
        }
        
        .formula-display {
            background: rgba(46, 204, 113, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .clear-btn {
            background: #E74C3C;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin: 10px 0;
            transition: all 0.3s;
        }
        
        .clear-btn:hover {
            background: #C0392B;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ§ª í™”í•™ ì‹¤í—˜ì‹¤</h1>
        
        <div class="ui">
            <div class="stat">âš—ï¸ ì‹¤í—˜: <span id="experiments">0</span>íšŒ</div>
            <div class="stat">âœ… ì„±ê³µ: <span id="successful">0</span>íšŒ</div>
            <div class="stat">ğŸ† ë°œê²¬: <span id="discoveries">0</span>ê°œ</div>
            <div class="stat">â­ ì ìˆ˜: <span id="score">0</span></div>
        </div>
        
        <div class="lab-area">
            <canvas id="gameCanvas" width="600" height="500"></canvas>
            
            <div class="sidebar">
                <h3>ğŸ§ª ì›ì†Œ ì„ íƒ</h3>
                <div class="element-panel" id="elementPanel">
                    <!-- ì›ì†Œ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
                
                <div class="formula-display" id="formulaDisplay">
                    í˜„ì¬ ì¡°í•©: ì—†ìŒ
                </div>
                
                <button class="clear-btn" onclick="clearLab()">ğŸ—‘ï¸ ì‹¤í—˜ì‹¤ ì²­ì†Œ</button>
                
                <h4>ğŸ“‹ ì‹¤í—˜ ê¸°ë¡</h4>
                <div class="reaction-log" id="reactionLog">
                    ì‹¤í—˜ì„ ì‹œì‘í•´ë³´ì„¸ìš”!
                </div>
            </div>
        </div>
        
        <div class="controls">
            <p>ğŸ® ì¡°ì‘ë²•: ì›ì†Œë¥¼ ì„ íƒí•˜ê³  ì‹¤í—˜ì‹¤ì— ë“œë˜ê·¸í•´ì„œ í™”í•™ ë°˜ì‘ì„ ì¼ìœ¼í‚¤ì„¸ìš”!</p>
            <p>ğŸ§ª ëª©í‘œ: ë‹¤ì–‘í•œ ì›ì†Œë¥¼ ì¡°í•©í•´ì„œ ìƒˆë¡œìš´ í™”í•©ë¬¼ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
            <p>ğŸ’¡ íŒ: ì‹¤ì œ í™”í•™ ê³µì‹ì„ ì°¸ê³ í•´ì„œ ì‹¤í—˜í•´ë³´ì„¸ìš”!</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            experiments: 0,
            successful: 0,
            discoveries: 0,
            score: 0,
            selectedElement: null
        };
        
        // ì›ì†Œ ë°ì´í„°
        const elements = {
            H: { name: 'ìˆ˜ì†Œ', color: '#FF6B6B', symbol: 'H', atomicNumber: 1 },
            O: { name: 'ì‚°ì†Œ', color: '#4ECDC4', symbol: 'O', atomicNumber: 8 },
            C: { name: 'íƒ„ì†Œ', color: '#45B7D1', symbol: 'C', atomicNumber: 6 },
            N: { name: 'ì§ˆì†Œ', color: '#96CEB4', symbol: 'N', atomicNumber: 7 },
            Na: { name: 'ë‚˜íŠ¸ë¥¨', color: '#FFEAA7', symbol: 'Na', atomicNumber: 11 },
            Cl: { name: 'ì—¼ì†Œ', color: '#DDA0DD', symbol: 'Cl', atomicNumber: 17 },
            Ca: { name: 'ì¹¼ìŠ˜', color: '#F0E68C', symbol: 'Ca', atomicNumber: 20 },
            Fe: { name: 'ì² ', color: '#CD853F', symbol: 'Fe', atomicNumber: 26 },
            S: { name: 'í™©', color: '#FFD700', symbol: 'S', atomicNumber: 16 },
            P: { name: 'ì¸', color: '#FF69B4', symbol: 'P', atomicNumber: 15 }
        };
        
        // í™”í•™ ë°˜ì‘ ë°ì´í„°
        const reactions = {
            'H+H+O': { product: 'Hâ‚‚O', name: 'ë¬¼', color: '#4169E1', points: 50 },
            'H+O': { product: 'OHâ»', name: 'ìˆ˜ì‚°í™” ì´ì˜¨', color: '#00CED1', points: 30 },
            'Na+Cl': { product: 'NaCl', name: 'ì†Œê¸ˆ', color: '#FFFFFF', points: 40 },
            'C+O+O': { product: 'COâ‚‚', name: 'ì´ì‚°í™”íƒ„ì†Œ', color: '#696969', points: 45 },
            'C+O': { product: 'CO', name: 'ì¼ì‚°í™”íƒ„ì†Œ', color: '#A0A0A0', points: 35 },
            'Ca+C+O+O+O': { product: 'CaCOâ‚ƒ', name: 'íƒ„ì‚°ì¹¼ìŠ˜', color: '#F5F5DC', points: 60 },
            'Fe+O+O+O': { product: 'Feâ‚‚Oâ‚ƒ', name: 'ì‚°í™”ì² ', color: '#B22222', points: 55 },
            'S+O+O': { product: 'SOâ‚‚', name: 'ì´ì‚°í™”í™©', color: '#FFFF99', points: 40 },
            'N+H+H+H': { product: 'NHâ‚ƒ', name: 'ì•”ëª¨ë‹ˆì•„', color: '#E0E0E0', points: 50 },
            'P+O+O+O+O+O': { product: 'Pâ‚‚Oâ‚…', name: 'ì˜¤ì‚°í™”ì¸', color: '#FFA500', points: 70 }
        };
        
        // ì‹¤í—˜ì‹¤ì˜ ì›ì†Œë“¤
        let labElements = [];
        let particles = [];
        let compounds = [];
        
        // ë“œë˜ê·¸ ìƒíƒœ
        let isDragging = false;
        let dragElement = null;
        
        // ì›ì†Œ íŒ¨ë„ ìƒì„±
        function createElementPanel() {
            const panel = document.getElementById('elementPanel');
            
            Object.keys(elements).forEach(symbol => {
                const element = elements[symbol];
                const button = document.createElement('button');
                button.className = 'element-btn';
                button.textContent = `${symbol} - ${element.name}`;
                button.style.backgroundColor = element.color;
                button.onclick = () => selectElement(symbol);
                panel.appendChild(button);
            });
        }
        
        // ì›ì†Œ ì„ íƒ
        function selectElement(symbol) {
            gameState.selectedElement = symbol;
            document.querySelectorAll('.element-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
        }
        
        // ìº”ë²„ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸
        canvas.addEventListener('click', (e) => {
            if (!gameState.selectedElement) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            addElementToLab(x, y, gameState.selectedElement);
        });
        
        // ì‹¤í—˜ì‹¤ì— ì›ì†Œ ì¶”ê°€
        function addElementToLab(x, y, symbol) {
            const element = elements[symbol];
            
            labElements.push({
                x: x,
                y: y,
                symbol: symbol,
                ...element,
                vx: (Math.random() - 0.5) * 2,
                vy: (Math.random() - 0.5) * 2,
                size: 20,
                id: Date.now() + Math.random()
            });
            
            // ë°˜ì‘ ì²´í¬
            setTimeout(() => {
                checkReactions();
            }, 100);
        }
        
        // í™”í•™ ë°˜ì‘ ì²´í¬
        function checkReactions() {
            const elementCounts = {};
            
            // í˜„ì¬ ì‹¤í—˜ì‹¤ì˜ ì›ì†Œë“¤ ì¹´ìš´íŠ¸
            labElements.forEach(element => {
                elementCounts[element.symbol] = (elementCounts[element.symbol] || 0) + 1;
            });
            
            // ê°€ëŠ¥í•œ ë°˜ì‘ ì²´í¬
            Object.keys(reactions).forEach(reactionKey => {
                const requiredElements = reactionKey.split('+');
                const requiredCounts = {};
                
                requiredElements.forEach(element => {
                    requiredCounts[element] = (requiredCounts[element] || 0) + 1;
                });
                
                // ë°˜ì‘ ê°€ëŠ¥í•œì§€ ì²´í¬
                let canReact = true;
                Object.keys(requiredCounts).forEach(element => {
                    if ((elementCounts[element] || 0) < requiredCounts[element]) {
                        canReact = false;
                    }
                });
                
                if (canReact) {
                    performReaction(reactionKey, requiredCounts);
                    return;
                }
            });
            
            updateFormulaDisplay();
        }
        
        // ë°˜ì‘ ìˆ˜í–‰
        function performReaction(reactionKey, requiredCounts) {
            const reaction = reactions[reactionKey];
            
            // ë°˜ì‘ì— ì‚¬ìš©ëœ ì›ì†Œë“¤ ì œê±°
            Object.keys(requiredCounts).forEach(element => {
                let removeCount = requiredCounts[element];
                labElements = labElements.filter(labElement => {
                    if (labElement.symbol === element && removeCount > 0) {
                        removeCount--;
                        return false;
                    }
                    return true;
                });
            });
            
            // ìƒˆë¡œìš´ í™”í•©ë¬¼ ìƒì„±
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            compounds.push({
                x: centerX,
                y: centerY,
                product: reaction.product,
                name: reaction.name,
                color: reaction.color,
                size: 30,
                life: 300,
                maxLife: 300
            });
            
            // íŒŒí‹°í´ íš¨ê³¼
            createParticles(centerX, centerY, reaction.color, 15);
            
            // ì ìˆ˜ ë° í†µê³„ ì—…ë°ì´íŠ¸
            gameState.experiments++;
            gameState.successful++;
            gameState.score += reaction.points;
            
            // ìƒˆë¡œìš´ ë°œê²¬ì¸ì§€ ì²´í¬
            const logElement = document.getElementById('reactionLog');
            if (!logElement.textContent.includes(reaction.name)) {
                gameState.discoveries++;
            }
            
            // ë¡œê·¸ ì¶”ê°€
            addToLog(`âœ… ${reaction.name} (${reaction.product}) ìƒì„±! +${reaction.points}ì `);
            
            updateUI();
        }
        
        // íŒŒí‹°í´ ìƒì„±
        function createParticles(x, y, color, count = 8) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    life: 30,
                    maxLife: 30,
                    color: color,
                    size: Math.random() * 4 + 2
                });
            }
        }
        
        // ë¡œê·¸ì— ì¶”ê°€
        function addToLog(message) {
            const log = document.getElementById('reactionLog');
            const time = new Date().toLocaleTimeString();
            log.innerHTML += `<div>[${time}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }
        
        // ê³µì‹ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateFormulaDisplay() {
            const elementCounts = {};
            
            labElements.forEach(element => {
                elementCounts[element.symbol] = (elementCounts[element.symbol] || 0) + 1;
            });
            
            let formula = '';
            Object.keys(elementCounts).forEach(symbol => {
                const count = elementCounts[symbol];
                formula += count > 1 ? `${symbol}${count} ` : `${symbol} `;
            });
            
            document.getElementById('formulaDisplay').textContent = 
                formula ? `í˜„ì¬ ì¡°í•©: ${formula.trim()}` : 'í˜„ì¬ ì¡°í•©: ì—†ìŒ';
        }
        
        // ì‹¤í—˜ì‹¤ ì²­ì†Œ
        function clearLab() {
            labElements = [];
            compounds = [];
            particles = [];
            updateFormulaDisplay();
        }
        
        // ì—…ë°ì´íŠ¸
        function update() {
            // ì›ì†Œë“¤ ë¬¼ë¦¬ ì‹œë®¬ë ˆì´ì…˜
            labElements.forEach(element => {
                element.x += element.vx;
                element.y += element.vy;
                
                // ê²½ê³„ ë°˜ì‚¬
                if (element.x <= element.size || element.x >= canvas.width - element.size) {
                    element.vx *= -0.8;
                    element.x = Math.max(element.size, Math.min(canvas.width - element.size, element.x));
                }
                if (element.y <= element.size || element.y >= canvas.height - element.size) {
                    element.vy *= -0.8;
                    element.y = Math.max(element.size, Math.min(canvas.height - element.size, element.y));
                }
                
                // ë§ˆì°°ë ¥
                element.vx *= 0.98;
                element.vy *= 0.98;
            });
            
            // ì›ì†Œê°„ ì¶©ëŒ
            for (let i = 0; i < labElements.length; i++) {
                for (let j = i + 1; j < labElements.length; j++) {
                    const elem1 = labElements[i];
                    const elem2 = labElements[j];
                    
                    const dx = elem2.x - elem1.x;
                    const dy = elem2.y - elem1.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < elem1.size + elem2.size) {
                        // ì¶©ëŒ ë°˜ì‘
                        const angle = Math.atan2(dy, dx);
                        const force = 2;
                        
                        elem1.vx -= Math.cos(angle) * force;
                        elem1.vy -= Math.sin(angle) * force;
                        elem2.vx += Math.cos(angle) * force;
                        elem2.vy += Math.sin(angle) * force;
                    }
                }
            }
            
            // í™”í•©ë¬¼ ì—…ë°ì´íŠ¸
            compounds.forEach((compound, index) => {
                compound.life--;
                if (compound.life <= 0) {
                    compounds.splice(index, 1);
                }
            });
            
            // íŒŒí‹°í´ ì—…ë°ì´íŠ¸
            particles.forEach((particle, index) => {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.vx *= 0.95;
                particle.vy *= 0.95;
                particle.life--;
                
                if (particle.life <= 0) {
                    particles.splice(index, 1);
                }
            });
        }
        
        // ë Œë”ë§
        function render() {
            // ë°°ê²½
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#ECF0F1');
            gradient.addColorStop(1, '#BDC3C7');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ì‹¤í—˜ëŒ€ ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#34495E';
            ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
            
            // ë¹„ì»¤ë“¤ ê·¸ë¦¬ê¸°
            for (let i = 0; i < 3; i++) {
                const x = 100 + i * 200;
                const y = canvas.height - 100;
                
                ctx.strokeStyle = '#2C3E50';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(x, y, 30, 0, Math.PI);
                ctx.lineTo(x - 30, y + 40);
                ctx.lineTo(x + 30, y + 40);
                ctx.closePath();
                ctx.stroke();
            }
            
            // ì›ì†Œë“¤ ê·¸ë¦¬ê¸°
            labElements.forEach(element => {
                // ì›ì†Œ ê·¸ë¦¼ì
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                ctx.beginPath();
                ctx.arc(element.x + 2, element.y + 2, element.size, 0, Math.PI * 2);
                ctx.fill();
                
                // ì›ì†Œ ëª¸ì²´
                ctx.fillStyle = element.color;
                ctx.beginPath();
                ctx.arc(element.x, element.y, element.size, 0, Math.PI * 2);
                ctx.fill();
                
                // ì›ì†Œ ê¸°í˜¸
                ctx.fillStyle = '#000000';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(element.symbol, element.x, element.y + 5);
                
                // ì›ì†Œ í…Œë‘ë¦¬
                ctx.strokeStyle = '#2C3E50';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(element.x, element.y, element.size, 0, Math.PI * 2);
                ctx.stroke();
            });
            
            // í™”í•©ë¬¼ë“¤ ê·¸ë¦¬ê¸°
            compounds.forEach(compound => {
                const alpha = compound.life / compound.maxLife;
                ctx.globalAlpha = alpha;
                
                // í™”í•©ë¬¼ ë°°ê²½
                ctx.fillStyle = compound.color;
                ctx.beginPath();
                ctx.arc(compound.x, compound.y, compound.size, 0, Math.PI * 2);
                ctx.fill();
                
                // í™”í•©ë¬¼ ì´ë¦„
                ctx.fillStyle = '#000000';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(compound.product, compound.x, compound.y + 3);
                
                // í™”í•©ë¬¼ í…Œë‘ë¦¬
                ctx.strokeStyle = '#2C3E50';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(compound.x, compound.y, compound.size, 0, Math.PI * 2);
                ctx.stroke();
            });
            ctx.globalAlpha = 1;
            
            // íŒŒí‹°í´
            particles.forEach(particle => {
                const alpha = particle.life / particle.maxLife;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
        }
        
        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            document.getElementById('experiments').textContent = gameState.experiments;
            document.getElementById('successful').textContent = gameState.successful;
            document.getElementById('discoveries').textContent = gameState.discoveries;
            document.getElementById('score').textContent = gameState.score;
        }
        
        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }
        
        // ê²Œì„ ì‹œì‘
        createElementPanel();
        addToLog('ğŸ§ª í™”í•™ ì‹¤í—˜ì‹¤ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!');
        addToLog('ğŸ’¡ ì›ì†Œë¥¼ ì„ íƒí•˜ê³  ì‹¤í—˜ì‹¤ì— ë°°ì¹˜í•´ë³´ì„¸ìš”.');
        gameLoop();
    </script>
</body>
</html>