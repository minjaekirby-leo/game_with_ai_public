<!DOCTYPE html>
<html>
<head>
    <title>ì—°ê·¹ ë¬´ëŒ€ ê²Œì„</title>
    
    <!-- Google Analytics -->
    <script src="../../analytics.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #8b0000 0%, #4b0000 50%, #2b0000 100%);
            color: white;
            text-align: center;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        h1 {
            font-size: 3rem;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            margin-bottom: 20px;
            animation: spotlight 3s ease-in-out infinite;
        }
        
        @keyframes spotlight {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
            50% { text-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 40px rgba(255, 255, 255, 0.5); }
        }
        
        .game-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        canvas {
            border: 4px solid #ffd700;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            background: linear-gradient(180deg, #2c1810 0%, #8b4513 100%);
            cursor: pointer;
        }
        
        .game-info {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 215, 0, 0.3);
            min-width: 200px;
        }
        
        .info-item {
            margin: 15px 0;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .actor-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .actor-btn {
            background: linear-gradient(45deg, #8b0000, #4b0000);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .actor-btn:hover {
            transform: scale(1.05);
            background: linear-gradient(45deg, #ffd700, #ffb347);
            color: #333;
        }
        
        .actor-btn.selected {
            background: linear-gradient(45deg, #ffd700, #ffb347);
            color: #333;
        }
        
        button {
            background: linear-gradient(45deg, #8b0000, #4b0000);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .instructions {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 600px;
            backdrop-filter: blur(5px);
        }
        
        #secretMessage {
            display: none;
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .scene-info {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <h1>ğŸ­ ì—°ê·¹ ë¬´ëŒ€</h1>
    
    <div class="instructions">
        <p><strong>ğŸ® ê²Œì„ ë°©ë²•:</strong></p>
        <p>ë°°ìš°ë¥¼ ì„ íƒí•˜ê³  ë¬´ëŒ€ì—ì„œ í´ë¦­í•´ì„œ ì›€ì§ì´ì„¸ìš”!</p>
        <p>ê° ì¥ë©´ì˜ ì§€ì‹œì‚¬í•­ì— ë”°ë¼ ë°°ìš°ë“¤ì„ ë°°ì¹˜í•˜ì„¸ìš”!</p>
        <p>ê´€ê°ë“¤ì˜ ë°•ìˆ˜ë¥¼ ë°›ìœ¼ë©´ ì ìˆ˜ë¥¼ ì–»ì–´ìš”!</p>
        <p>ğŸ’– ë¹„ë°€: "ì„œë¯¼ì¬ì‚¬ë‘í•´"ë¥¼ ì…ë ¥í•˜ë©´ íŠ¹ë³„í•œ ì¼ì´...?</p>
    </div>
    
    <div class="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="game-info">
            <div class="info-item">ì ìˆ˜: <span id="score">0</span></div>
            <div class="info-item">ì¥ë©´: <span id="scene">1</span></div>
            <div class="info-item">ë°•ìˆ˜: <span id="applause">0</span></div>
            <div class="info-item">ìµœê³  ê¸°ë¡: <span id="bestScore">0</span></div>
            
            <div class="scene-info" id="sceneInfo">
                ì²« ë²ˆì§¸ ì¥ë©´: ì™•ê³¼ ì™•ë¹„ê°€ ë§Œë‚˜ëŠ” ì¥ë©´
            </div>
            
            <div class="actor-controls">
                <button class="actor-btn" onclick="selectActor('king')">ğŸ‘‘ ì™•</button>
                <button class="actor-btn" onclick="selectActor('queen')">ğŸ‘¸ ì™•ë¹„</button>
                <button class="actor-btn" onclick="selectActor('knight')">âš”ï¸ ê¸°ì‚¬</button>
                <button class="actor-btn" onclick="selectActor('jester')">ğŸƒ ê´‘ëŒ€</button>
            </div>
            
            <div id="secretMessage">
                ğŸ’– ë¹„ë°€ ì•”í˜¸ í™œì„±í™”!<br>ì™„ë²½í•œ ì—°ê¸° ëª¨ë“œ ON! ğŸ’–
            </div>
            
            <button onclick="nextScene()">ë‹¤ìŒ ì¥ë©´</button>
            <button onclick="resetGame()">ìƒˆ ê²Œì„</button>
        </div>
    </div>

    <script>
        // ìº”ë²„ìŠ¤ ì„¤ì •
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ê²Œì„ ìƒíƒœ
        let score = 0;
        let currentScene = 1;
        let applause = 0;
        let bestScore = localStorage.getItem('theaterBestScore') || 0;
        let selectedActor = null;
        
        // ë¹„ë°€ ì•”í˜¸ ê´€ë ¨ ë³€ìˆ˜
        let secretMode = false;
        let secretInput = '';
        const secretPassword = 'ì„œë¯¼ì¬ì‚¬ë‘í•´';
        
        // ë°°ìš°ë“¤
        let actors = {
            king: { x: 100, y: 400, emoji: 'ğŸ‘‘', name: 'ì™•', color: '#ffd700', active: false },
            queen: { x: 200, y: 400, emoji: 'ğŸ‘¸', name: 'ì™•ë¹„', color: '#ff69b4', active: false },
            knight: { x: 300, y: 400, emoji: 'âš”ï¸', name: 'ê¸°ì‚¬', color: '#c0c0c0', active: false },
            jester: { x: 400, y: 400, emoji: 'ğŸƒ', name: 'ê´‘ëŒ€', color: '#ff6b6b', active: false }
        };
        
        // ì¥ë©´ ì„¤ì •
        const scenes = [
            {
                title: "ì²« ë²ˆì§¸ ì¥ë©´: ì™•ê³¼ ì™•ë¹„ê°€ ë§Œë‚˜ëŠ” ì¥ë©´",
                requirements: [
                    { actor: 'king', x: 300, y: 300, tolerance: 80 },
                    { actor: 'queen', x: 500, y: 300, tolerance: 80 }
                ],
                description: "ì™•ê³¼ ì™•ë¹„ë¥¼ ë¬´ëŒ€ ì¤‘ì•™ì— ë°°ì¹˜í•˜ì„¸ìš”!"
            },
            {
                title: "ë‘ ë²ˆì§¸ ì¥ë©´: ê¸°ì‚¬ê°€ ë“±ì¥í•˜ëŠ” ì¥ë©´",
                requirements: [
                    { actor: 'king', x: 200, y: 250, tolerance: 60 },
                    { actor: 'queen', x: 600, y: 250, tolerance: 60 },
                    { actor: 'knight', x: 400, y: 200, tolerance: 60 }
                ],
                description: "ê¸°ì‚¬ê°€ ì™•ê³¼ ì™•ë¹„ ì‚¬ì´ì— ì„œë„ë¡ ë°°ì¹˜í•˜ì„¸ìš”!"
            },
            {
                title: "ì„¸ ë²ˆì§¸ ì¥ë©´: ê´‘ëŒ€ê°€ ëª¨ë‘ë¥¼ ì¦ê²ê²Œ í•˜ëŠ” ì¥ë©´",
                requirements: [
                    { actor: 'king', x: 150, y: 350, tolerance: 70 },
                    { actor: 'queen', x: 650, y: 350, tolerance: 70 },
                    { actor: 'knight', x: 300, y: 200, tolerance: 70 },
                    { actor: 'jester', x: 400, y: 300, tolerance: 70 }
                ],
                description: "ê´‘ëŒ€ë¥¼ ì¤‘ì•™ì—, ë‹¤ë¥¸ ë°°ìš°ë“¤ì„ ë‘˜ëŸ¬ì‹¸ê²Œ ë°°ì¹˜í•˜ì„¸ìš”!"
            },
            {
                title: "ë„¤ ë²ˆì§¸ ì¥ë©´: ëŒ€ë‹¨ì›ì˜ ë§ˆì§€ë§‰",
                requirements: [
                    { actor: 'king', x: 300, y: 200, tolerance: 50 },
                    { actor: 'queen', x: 500, y: 200, tolerance: 50 },
                    { actor: 'knight', x: 250, y: 300, tolerance: 50 },
                    { actor: 'jester', x: 550, y: 300, tolerance: 50 }
                ],
                description: "ëª¨ë“  ë°°ìš°ë“¤ì´ ì¡°í™”ë¡­ê²Œ ë°°ì¹˜ë˜ë„ë¡ í•˜ì„¸ìš”!"
            }
        ];
        
        // ê´€ê°ë“¤
        let audience = [];
        let spotlights = [];
        let particles = [];
        
        // ê´€ê° ìƒì„±
        function createAudience() {
            audience = [];
            for (let i = 0; i < 20; i++) {
                audience.push({
                    x: 50 + i * 35,
                    y: 500 + Math.random() * 50,
                    happiness: 0,
                    clapTimer: 0
                });
            }
        }
        
        // ìŠ¤í¬íŠ¸ë¼ì´íŠ¸ ìƒì„±
        function createSpotlights() {
            spotlights = [];
            for (let i = 0; i < 3; i++) {
                spotlights.push({
                    x: 200 + i * 200,
                    y: 100,
                    radius: 80,
                    intensity: Math.random() * 0.3 + 0.7
                });
            }
        }
        
        // íŒŒí‹°í´ íš¨ê³¼
        function createApplauseParticles(x, y) {
            for (let i = 0; i < 8; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 6,
                    vy: Math.random() * -4 - 2,
                    life: 40,
                    color: secretMode ? '#ffd700' : '#ff6b6b',
                    type: 'applause'
                });
            }
        }
        
        function createSparkleParticles(x, y) {
            for (let i = 0; i < 5; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 4,
                    vy: (Math.random() - 0.5) * 4,
                    life: 30,
                    color: '#ffd700',
                    type: 'sparkle'
                });
            }
        }
        
        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2;
                p.life--;
                
                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }
        
        // ì´ˆê¸°í™”
        document.getElementById('bestScore').textContent = bestScore;
        createAudience();
        createSpotlights();
        
        // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
        canvas.addEventListener('click', (e) => {
            if (!selectedActor) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // ë¬´ëŒ€ ì˜ì—­ í™•ì¸ (y < 450)
            if (y < 450) {
                actors[selectedActor].x = x;
                actors[selectedActor].y = y;
                
                // ìŠ¤íŒŒí´ íš¨ê³¼
                createSparkleParticles(x, y);
                
                // ì¥ë©´ ìš”êµ¬ì‚¬í•­ í™•ì¸
                checkSceneRequirements();
            }
        });
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (ë¹„ë°€ ì•”í˜¸)
        document.addEventListener('keydown', (e) => {
            if (e.key.length === 1) {
                secretInput += e.key;
                if (secretInput.length > secretPassword.length) {
                    secretInput = secretInput.slice(-secretPassword.length);
                }
                
                if (secretInput === secretPassword) {
                    secretMode = !secretMode;
                    document.getElementById('secretMessage').style.display = secretMode ? 'block' : 'none';
                    secretInput = '';
                }
            }
        });
        
        function selectActor(actorType) {
            selectedActor = selectedActor === actorType ? null : actorType;
            
            // ëª¨ë“  ë°°ìš° ë¹„í™œì„±í™”
            Object.keys(actors).forEach(key => {
                actors[key].active = false;
            });
            
            // ì„ íƒëœ ë°°ìš° í™œì„±í™”
            if (selectedActor) {
                actors[selectedActor].active = true;
            }
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.actor-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            if (selectedActor) {
                event.target.classList.add('selected');
            }
        }
        
        function checkSceneRequirements() {
            const scene = scenes[currentScene - 1];
            let correctPositions = 0;
            
            for (let req of scene.requirements) {
                const actor = actors[req.actor];
                const distance = Math.sqrt((actor.x - req.x)**2 + (actor.y - req.y)**2);
                
                if (distance <= req.tolerance) {
                    correctPositions++;
                }
            }
            
            // ê´€ê° ë°˜ì‘ ì—…ë°ì´íŠ¸
            const satisfaction = correctPositions / scene.requirements.length;
            
            for (let person of audience) {
                person.happiness = satisfaction;
                if (satisfaction > 0.8 || secretMode) {
                    person.clapTimer = 60;
                    if (Math.random() < 0.1) {
                        createApplauseParticles(person.x, person.y - 20);
                    }
                }
            }
            
            // ì ìˆ˜ ê³„ì‚°
            if (satisfaction >= 1.0 || secretMode) {
                const bonus = secretMode ? 200 : 100;
                score += bonus;
                applause += 10;
                
                // ì™„ë²½í•œ ë°°ì¹˜ íŒŒí‹°í´
                for (let req of scene.requirements) {
                    const actor = actors[req.actor];
                    createApplauseParticles(actor.x, actor.y - 30);
                }
            }
            
            updateDisplay();
        }
        
        function nextScene() {
            if (currentScene < scenes.length) {
                currentScene++;
                updateSceneInfo();
                
                // ë°°ìš°ë“¤ ì´ˆê¸° ìœ„ì¹˜ë¡œ ë¦¬ì…‹
                actors.king.x = 100;
                actors.king.y = 400;
                actors.queen.x = 200;
                actors.queen.y = 400;
                actors.knight.x = 300;
                actors.knight.y = 400;
                actors.jester.x = 400;
                actors.jester.y = 400;
                
                selectedActor = null;
                document.querySelectorAll('.actor-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                Object.keys(actors).forEach(key => {
                    actors[key].active = false;
                });
            } else {
                // ê²Œì„ ì™„ë£Œ
                if (score > bestScore) {
                    bestScore = score;
                    localStorage.setItem('theaterBestScore', bestScore);
                    document.getElementById('bestScore').textContent = bestScore;
                }
                alert(`ì—°ê·¹ ì™„ë£Œ! ìµœì¢… ì ìˆ˜: ${score}`);
            }
        }
        
        function updateSceneInfo() {
            const scene = scenes[currentScene - 1];
            document.getElementById('sceneInfo').textContent = scene.title;
        }
        
        function resetGame() {
            score = 0;
            currentScene = 1;
            applause = 0;
            selectedActor = null;
            
            // ë°°ìš°ë“¤ ì´ˆê¸° ìœ„ì¹˜ë¡œ ë¦¬ì…‹
            actors.king.x = 100;
            actors.king.y = 400;
            actors.queen.x = 200;
            actors.queen.y = 400;
            actors.knight.x = 300;
            actors.knight.y = 400;
            actors.jester.x = 400;
            actors.jester.y = 400;
            
            Object.keys(actors).forEach(key => {
                actors[key].active = false;
            });
            
            particles = [];
            createAudience();
            
            document.querySelectorAll('.actor-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            updateSceneInfo();
            updateDisplay();
        }
        
        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('scene').textContent = currentScene;
            document.getElementById('applause').textContent = applause;
        }
        
        function draw() {
            // ë°°ê²½ ê·¸ë¦¬ê¸°
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, secretMode ? '#1a1a2e' : '#2c1810');
            gradient.addColorStop(0.7, secretMode ? '#16213e' : '#8b4513');
            gradient.addColorStop(1, '#654321');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ë¬´ëŒ€ ê·¸ë¦¬ê¸°
            ctx.fillStyle = secretMode ? '#ffd700' : '#daa520';
            ctx.fillRect(0, 450, canvas.width, 150);
            
            // ë¬´ëŒ€ ê²½ê³„ì„ 
            ctx.strokeStyle = '#8b4513';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, 450);
            ctx.lineTo(canvas.width, 450);
            ctx.stroke();
            
            // ìŠ¤í¬íŠ¸ë¼ì´íŠ¸ íš¨ê³¼
            for (let spotlight of spotlights) {
                const gradient = ctx.createRadialGradient(
                    spotlight.x, spotlight.y, 0,
                    spotlight.x, spotlight.y, spotlight.radius
                );
                gradient.addColorStop(0, `rgba(255, 255, 255, ${spotlight.intensity})`);
                gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(spotlight.x, spotlight.y, spotlight.radius, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // ì¥ë©´ ìš”êµ¬ì‚¬í•­ í‘œì‹œ (ë°˜íˆ¬ëª… ì›)
            if (currentScene <= scenes.length) {
                const scene = scenes[currentScene - 1];
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                
                for (let req of scene.requirements) {
                    ctx.beginPath();
                    ctx.arc(req.x, req.y, req.tolerance, 0, Math.PI * 2);
                    ctx.stroke();
                }
                ctx.setLineDash([]);
            }
            
            // ë°°ìš°ë“¤ ê·¸ë¦¬ê¸°
            for (let [key, actor] of Object.entries(actors)) {
                // ì„ íƒëœ ë°°ìš° í•˜ì´ë¼ì´íŠ¸
                if (actor.active) {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.beginPath();
                    ctx.arc(actor.x, actor.y, 35, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // ë°°ìš° ê·¸ë¦¼ì
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.beginPath();
                ctx.ellipse(actor.x, actor.y + 25, 20, 8, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // ë°°ìš° ë³¸ì²´
                ctx.fillStyle = actor.color;
                ctx.beginPath();
                ctx.arc(actor.x, actor.y, 25, 0, Math.PI * 2);
                ctx.fill();
                
                // ë°°ìš° ì´ëª¨ì§€
                ctx.font = '30px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(actor.emoji, actor.x, actor.y + 10);
                
                // ë°°ìš° ì´ë¦„
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.fillText(actor.name, actor.x, actor.y + 45);
            }
            
            // ê´€ê° ê·¸ë¦¬ê¸°
            for (let person of audience) {
                // ê´€ê° ëª¸
                ctx.fillStyle = person.happiness > 0.5 ? '#4ecdc4' : '#95a5a6';
                ctx.beginPath();
                ctx.arc(person.x, person.y, 8, 0, Math.PI * 2);
                ctx.fill();
                
                // ë°•ìˆ˜ íš¨ê³¼
                if (person.clapTimer > 0) {
                    person.clapTimer--;
                    ctx.fillStyle = '#ffd700';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('ğŸ‘', person.x, person.y - 15);
                }
            }
            
            // íŒŒí‹°í´ ê·¸ë¦¬ê¸°
            for (let p of particles) {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / 40;
                
                if (p.type === 'sparkle') {
                    ctx.font = '16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('âœ¨', p.x, p.y);
                } else {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            ctx.globalAlpha = 1;
            
            // ì»¤íŠ¼ ê·¸ë¦¬ê¸°
            ctx.fillStyle = secretMode ? '#ff6b6b' : '#8b0000';
            ctx.fillRect(0, 0, 50, canvas.height);
            ctx.fillRect(canvas.width - 50, 0, 50, canvas.height);
            
            // ì»¤íŠ¼ ë””í…Œì¼
            ctx.fillStyle = secretMode ? '#e74c3c' : '#4b0000';
            for (let i = 0; i < 10; i++) {
                ctx.fillRect(5, i * 60, 40, 20);
                ctx.fillRect(canvas.width - 45, i * 60, 40, 20);
            }
        }
        
        function gameLoop() {
            updateParticles();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // ê²Œì„ ì‹œì‘
        updateSceneInfo();
        updateDisplay();
        gameLoop();
    </script>
</body>
</html>