<!DOCTYPE html>
<html>
<head>
    <title>ë¯¸ë‹ˆ RPG ê²Œì„</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            text-align: center;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        h1 {
            font-size: 3rem;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            color: #f39c12;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 3px 3px 6px rgba(0,0,0,0.5); }
            to { text-shadow: 3px 3px 20px rgba(243, 156, 18, 0.8); }
        }
        
        .game-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px auto;
            max-width: 1200px;
            flex-wrap: wrap;
        }
        
        .game-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        canvas {
            border: 3px solid #f39c12;
            border-radius: 10px;
            background: #2c3e50;
        }
        
        .ui-panel {
            width: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .player-stats {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .stat-bar {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            height: 20px;
            margin: 5px 0;
            position: relative;
            overflow: hidden;
        }
        
        .stat-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .hp-fill { background: linear-gradient(90deg, #e74c3c, #c0392b); }
        .mp-fill { background: linear-gradient(90deg, #3498db, #2980b9); }
        .exp-fill { background: linear-gradient(90deg, #f39c12, #e67e22); }
        
        .stat-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .inventory {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .item-slot {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            margin: 2px;
            text-align: center;
            line-height: 36px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .item-slot:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .controls {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
        }
        
        button {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .message-log {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            height: 150px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 800px;
            backdrop-filter: blur(5px);
        }
        
        .battle-ui {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            display: none;
            z-index: 100;
            border: 3px solid #e74c3c;
            min-width: 400px;
        }
        
        .enemy-info {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .battle-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ° ë¯¸ë‹ˆ RPG ë˜ì „</h1>
    
    <div class="instructions">
        <p><strong>ğŸ® ì¡°ì‘ë²•:</strong> WASD ë˜ëŠ” í™”ì‚´í‘œ í‚¤ë¡œ ì´ë™</p>
        <p><strong>ğŸ¯ ëª©í‘œ:</strong> ë˜ì „ì„ íƒí—˜í•˜ê³  ëª¬ìŠ¤í„°ë¥¼ ë¬¼ë¦¬ì¹˜ë©° ë ˆë²¨ì—…í•˜ì„¸ìš”!</p>
        <p><strong>âš”ï¸ ì „íˆ¬:</strong> ëª¬ìŠ¤í„°ì™€ ë§Œë‚˜ë©´ ìë™ìœ¼ë¡œ ì „íˆ¬ê°€ ì‹œì‘ë©ë‹ˆë‹¤!</p>
    </div>
    
    <div class="game-container">
        <div class="game-area">
            <canvas id="gameCanvas" width="600" height="600"></canvas>
        </div>
        
        <div class="ui-panel">
            <div class="player-stats">
                <h3>ğŸ§™â€â™‚ï¸ í”Œë ˆì´ì–´ ìƒíƒœ</h3>
                <div>ë ˆë²¨: <span id="playerLevel">1</span></div>
                <div>ê³¨ë“œ: <span id="playerGold">0</span>G</div>
                
                <div class="stat-bar">
                    <div class="stat-fill hp-fill" id="hpBar"></div>
                    <div class="stat-text" id="hpText">HP: 100/100</div>
                </div>
                
                <div class="stat-bar">
                    <div class="stat-fill mp-fill" id="mpBar"></div>
                    <div class="stat-text" id="mpText">MP: 50/50</div>
                </div>
                
                <div class="stat-bar">
                    <div class="stat-fill exp-fill" id="expBar"></div>
                    <div class="stat-text" id="expText">EXP: 0/100</div>
                </div>
            </div>
            
            <div class="inventory">
                <h3>ğŸ’ ì¸ë²¤í† ë¦¬</h3>
                <div id="inventorySlots">
                    <!-- ì¸ë²¤í† ë¦¬ ìŠ¬ë¡¯ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <div class="controls">
                <button onclick="usePotion('hp')">ğŸ§ª ì²´ë ¥ í¬ì…˜</button>
                <button onclick="usePotion('mp')">ğŸ’™ ë§ˆë‚˜ í¬ì…˜</button>
                <button onclick="resetGame()">ğŸ”„ ìƒˆ ê²Œì„</button>
            </div>
            
            <div class="message-log" id="messageLog">
                <div>ë˜ì „ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</div>
                <div>WASD í‚¤ë¡œ ì´ë™í•˜ì„¸ìš”.</div>
            </div>
        </div>
    </div>
    
    <div class="battle-ui" id="battleUI">
        <div class="enemy-info">
            <h3 id="enemyName">ê³ ë¸”ë¦°</h3>
            <div class="stat-bar">
                <div class="stat-fill hp-fill" id="enemyHpBar"></div>
                <div class="stat-text" id="enemyHpText">HP: 50/50</div>
            </div>
        </div>
        
        <div class="battle-actions">
            <button onclick="battleAction('attack')">âš”ï¸ ê³µê²©</button>
            <button onclick="battleAction('magic')">âœ¨ ë§ˆë²•</button>
            <button onclick="battleAction('defend')">ğŸ›¡ï¸ ë°©ì–´</button>
            <button onclick="battleAction('run')">ğŸƒâ€â™‚ï¸ ë„ë§</button>
        </div>
    </div>

    <script>
        // ìº”ë²„ìŠ¤ ì„¤ì •
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ê²Œì„ ìƒíƒœ
        let gameRunning = true;
        let inBattle = false;
        let currentEnemy = null;

        // í”Œë ˆì´ì–´ ì„¤ì •
        const player = {
            x: 5,
            y: 5,
            level: 1,
            hp: 100,
            maxHp: 100,
            mp: 50,
            maxMp: 50,
            exp: 0,
            expToNext: 100,
            gold: 0,
            attack: 20,
            defense: 10,
            inventory: {
                hpPotions: 3,
                mpPotions: 2,
                keys: 0,
                treasures: 0
            }
        };

        // ë˜ì „ ë§µ (0: ë¹ˆ ê³µê°„, 1: ë²½, 2: ëª¬ìŠ¤í„°, 3: ë³´ë¬¼, 4: ê³„ë‹¨)
        const dungeonMap = [
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,1,0,0,0,0,0,1,0,3,0,1],
            [1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,1,1,1,1,0,1,1,1,1,1,2,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,2,1,1,1,0,1,1,1,0,1,1,1,0,1],
            [1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],
            [1,0,1,0,1,1,1,2,1,1,1,0,1,3,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,1,1,1,1,0,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,2,1,0,1,1,1,1,1,1,1,0,1,2,1],
            [1,0,0,0,0,0,0,4,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ];

        // ëª¬ìŠ¤í„° ë°ì´í„°
        const monsters = {
            goblin: { name: 'ê³ ë¸”ë¦°', hp: 50, attack: 15, defense: 5, exp: 25, gold: 10, emoji: 'ğŸ‘¹' },
            orc: { name: 'ì˜¤í¬', hp: 80, attack: 25, defense: 8, exp: 40, gold: 20, emoji: 'ğŸ‘º' },
            skeleton: { name: 'ìŠ¤ì¼ˆë ˆí†¤', hp: 60, attack: 20, defense: 6, exp: 30, gold: 15, emoji: 'ğŸ’€' },
            dragon: { name: 'ë“œë˜ê³¤', hp: 200, attack: 50, defense: 20, exp: 100, gold: 100, emoji: 'ğŸ‰' }
        };

        // íƒ€ì¼ í¬ê¸°
        const TILE_SIZE = 40;

        // ë˜ì „ ê·¸ë¦¬ê¸°
        function drawDungeon() {
            for (let y = 0; y < dungeonMap.length; y++) {
                for (let x = 0; x < dungeonMap[y].length; x++) {
                    const tileX = x * TILE_SIZE;
                    const tileY = y * TILE_SIZE;
                    
                    switch (dungeonMap[y][x]) {
                        case 0: // ë¹ˆ ê³µê°„
                            ctx.fillStyle = '#34495e';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            break;
                        case 1: // ë²½
                            ctx.fillStyle = '#2c3e50';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#1a252f';
                            ctx.fillRect(tileX + 2, tileY + 2, TILE_SIZE - 4, TILE_SIZE - 4);
                            break;
                        case 2: // ëª¬ìŠ¤í„°
                            ctx.fillStyle = '#34495e';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#e74c3c';
                            ctx.font = '24px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸ‘¹', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 8);
                            break;
                        case 3: // ë³´ë¬¼
                            ctx.fillStyle = '#34495e';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#f39c12';
                            ctx.font = '24px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸ’°', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 8);
                            break;
                        case 4: // ê³„ë‹¨
                            ctx.fillStyle = '#34495e';
                            ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
                            ctx.fillStyle = '#9b59b6';
                            ctx.font = '24px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('ğŸšª', tileX + TILE_SIZE/2, tileY + TILE_SIZE/2 + 8);
                            break;
                    }
                }
            }
        }

        // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸°
        function drawPlayer() {
            const playerX = player.x * TILE_SIZE;
            const playerY = player.y * TILE_SIZE;
            
            ctx.fillStyle = '#3498db';
            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ§™â€â™‚ï¸', playerX + TILE_SIZE/2, playerY + TILE_SIZE/2 + 10);
        }

        // ê²Œì„ ê·¸ë¦¬ê¸°
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawDungeon();
            drawPlayer();
        }

        // í”Œë ˆì´ì–´ ì´ë™
        function movePlayer(dx, dy) {
            if (inBattle) return;
            
            const newX = player.x + dx;
            const newY = player.y + dy;
            
            // ê²½ê³„ í™•ì¸
            if (newX < 0 || newX >= dungeonMap[0].length || 
                newY < 0 || newY >= dungeonMap.length) {
                return;
            }
            
            const tile = dungeonMap[newY][newX];
            
            // ë²½ ì¶©ëŒ í™•ì¸
            if (tile === 1) {
                addMessage('ë²½ì— ë¶€ë”ªí˜”ìŠµë‹ˆë‹¤!');
                return;
            }
            
            // ì´ë™
            player.x = newX;
            player.y = newY;
            
            // íƒ€ì¼ ìƒí˜¸ì‘ìš©
            handleTileInteraction(tile);
            
            draw();
        }

        // íƒ€ì¼ ìƒí˜¸ì‘ìš©
        function handleTileInteraction(tile) {
            switch (tile) {
                case 2: // ëª¬ìŠ¤í„°
                    startBattle();
                    break;
                case 3: // ë³´ë¬¼
                    findTreasure();
                    dungeonMap[player.y][player.x] = 0; // ë³´ë¬¼ ì œê±°
                    break;
                case 4: // ê³„ë‹¨
                    nextLevel();
                    break;
            }
        }

        // ì „íˆ¬ ì‹œì‘
        function startBattle() {
            inBattle = true;
            
            // ëœë¤ ëª¬ìŠ¤í„° ì„ íƒ
            const monsterTypes = Object.keys(monsters);
            const randomType = monsterTypes[Math.floor(Math.random() * monsterTypes.length)];
            currentEnemy = { ...monsters[randomType] };
            currentEnemy.maxHp = currentEnemy.hp;
            
            addMessage(`${currentEnemy.name}ê³¼ ì¡°ìš°í–ˆìŠµë‹ˆë‹¤!`);
            
            // ì „íˆ¬ UI í‘œì‹œ
            document.getElementById('enemyName').textContent = currentEnemy.name + ' ' + currentEnemy.emoji;
            updateEnemyUI();
            document.getElementById('battleUI').style.display = 'block';
        }

        // ì „íˆ¬ ì•¡ì…˜
        function battleAction(action) {
            if (!inBattle) return;
            
            let playerDamage = 0;
            let enemyDamage = 0;
            
            switch (action) {
                case 'attack':
                    playerDamage = Math.max(1, player.attack - currentEnemy.defense + Math.floor(Math.random() * 10) - 5);
                    currentEnemy.hp -= playerDamage;
                    addMessage(`${currentEnemy.name}ì—ê²Œ ${playerDamage} ë°ë¯¸ì§€!`);
                    break;
                    
                case 'magic':
                    if (player.mp >= 10) {
                        playerDamage = player.attack * 1.5;
                        currentEnemy.hp -= playerDamage;
                        player.mp -= 10;
                        addMessage(`ë§ˆë²• ê³µê²©ìœ¼ë¡œ ${playerDamage} ë°ë¯¸ì§€!`);
                    } else {
                        addMessage('ë§ˆë‚˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!');
                        return;
                    }
                    break;
                    
                case 'defend':
                    addMessage('ë°©ì–´ íƒœì„¸ë¥¼ ì·¨í–ˆìŠµë‹ˆë‹¤!');
                    enemyDamage = Math.max(1, Math.floor((currentEnemy.attack - player.defense * 2) / 2));
                    break;
                    
                case 'run':
                    if (Math.random() < 0.7) {
                        addMessage('ì„±ê³µì ìœ¼ë¡œ ë„ë§ì³¤ìŠµë‹ˆë‹¤!');
                        endBattle(false);
                        return;
                    } else {
                        addMessage('ë„ë§ì¹˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤!');
                    }
                    break;
            }
            
            // ì ì´ ì£½ì—ˆëŠ”ì§€ í™•ì¸
            if (currentEnemy.hp <= 0) {
                addMessage(`${currentEnemy.name}ì„ ë¬¼ë¦¬ì³¤ìŠµë‹ˆë‹¤!`);
                gainExp(currentEnemy.exp);
                gainGold(currentEnemy.gold);
                dungeonMap[player.y][player.x] = 0; // ëª¬ìŠ¤í„° ì œê±°
                endBattle(true);
                return;
            }
            
            // ì  ê³µê²© (ë°©ì–´í•˜ì§€ ì•Šì•˜ì„ ë•Œ)
            if (action !== 'defend') {
                enemyDamage = Math.max(1, currentEnemy.attack - player.defense + Math.floor(Math.random() * 5) - 2);
            }
            
            if (enemyDamage > 0) {
                player.hp -= enemyDamage;
                addMessage(`${currentEnemy.name}ì´ ${enemyDamage} ë°ë¯¸ì§€ë¥¼ ì…í˜”ìŠµë‹ˆë‹¤!`);
            }
            
            // í”Œë ˆì´ì–´ê°€ ì£½ì—ˆëŠ”ì§€ í™•ì¸
            if (player.hp <= 0) {
                addMessage('ë‹¹ì‹ ì€ ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤... ê²Œì„ ì˜¤ë²„!');
                gameOver();
                return;
            }
            
            updateUI();
            updateEnemyUI();
        }

        // ì „íˆ¬ ì¢…ë£Œ
        function endBattle(victory) {
            inBattle = false;
            currentEnemy = null;
            document.getElementById('battleUI').style.display = 'none';
            
            if (victory) {
                // ëœë¤ ì•„ì´í…œ ë“œë¡­
                if (Math.random() < 0.3) {
                    if (Math.random() < 0.5) {
                        player.inventory.hpPotions++;
                        addMessage('ì²´ë ¥ í¬ì…˜ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!');
                    } else {
                        player.inventory.mpPotions++;
                        addMessage('ë§ˆë‚˜ í¬ì…˜ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!');
                    }
                }
            }
            
            updateUI();
        }

        // ë³´ë¬¼ ë°œê²¬
        function findTreasure() {
            const goldFound = Math.floor(Math.random() * 50) + 20;
            gainGold(goldFound);
            addMessage(`ë³´ë¬¼ìƒìì—ì„œ ${goldFound} ê³¨ë“œë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!`);
            
            // ëœë¤ ì•„ì´í…œ
            if (Math.random() < 0.5) {
                player.inventory.hpPotions++;
                addMessage('ì²´ë ¥ í¬ì…˜ë„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!');
            }
        }

        // ë‹¤ìŒ ë ˆë²¨
        function nextLevel() {
            addMessage('ë‹¤ìŒ ì¸µìœ¼ë¡œ ë‚´ë ¤ê°‘ë‹ˆë‹¤...');
            // ê°„ë‹¨íˆ ì²´ë ¥/ë§ˆë‚˜ íšŒë³µ
            player.hp = player.maxHp;
            player.mp = player.maxMp;
            addMessage('ì²´ë ¥ê³¼ ë§ˆë‚˜ê°€ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤!');
            updateUI();
        }

        // ê²½í—˜ì¹˜ íšë“
        function gainExp(exp) {
            player.exp += exp;
            addMessage(`${exp} ê²½í—˜ì¹˜ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`);
            
            // ë ˆë²¨ì—… í™•ì¸
            while (player.exp >= player.expToNext) {
                levelUp();
            }
        }

        // ë ˆë²¨ì—…
        function levelUp() {
            player.exp -= player.expToNext;
            player.level++;
            player.expToNext = player.level * 100;
            
            // ìŠ¤íƒ¯ ì¦ê°€
            const hpIncrease = 20;
            const mpIncrease = 10;
            player.maxHp += hpIncrease;
            player.maxMp += mpIncrease;
            player.hp = player.maxHp; // ë ˆë²¨ì—… ì‹œ ì™„ì „ íšŒë³µ
            player.mp = player.maxMp;
            player.attack += 5;
            player.defense += 3;
            
            addMessage(`ë ˆë²¨ ì—…! ë ˆë²¨ ${player.level}ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            addMessage(`ì²´ë ¥ +${hpIncrease}, ë§ˆë‚˜ +${mpIncrease}, ê³µê²©ë ¥ +5, ë°©ì–´ë ¥ +3`);
        }

        // ê³¨ë“œ íšë“
        function gainGold(gold) {
            player.gold += gold;
        }

        // í¬ì…˜ ì‚¬ìš©
        function usePotion(type) {
            if (inBattle) {
                addMessage('ì „íˆ¬ ì¤‘ì—ëŠ” í¬ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            if (type === 'hp' && player.inventory.hpPotions > 0) {
                if (player.hp < player.maxHp) {
                    player.inventory.hpPotions--;
                    const healAmount = 50;
                    player.hp = Math.min(player.maxHp, player.hp + healAmount);
                    addMessage(`ì²´ë ¥ í¬ì…˜ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤! (+${healAmount} HP)`);
                } else {
                    addMessage('ì²´ë ¥ì´ ì´ë¯¸ ê°€ë“í•©ë‹ˆë‹¤!');
                }
            } else if (type === 'mp' && player.inventory.mpPotions > 0) {
                if (player.mp < player.maxMp) {
                    player.inventory.mpPotions--;
                    const restoreAmount = 30;
                    player.mp = Math.min(player.maxMp, player.mp + restoreAmount);
                    addMessage(`ë§ˆë‚˜ í¬ì…˜ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤! (+${restoreAmount} MP)`);
                } else {
                    addMessage('ë§ˆë‚˜ê°€ ì´ë¯¸ ê°€ë“í•©ë‹ˆë‹¤!');
                }
            } else {
                addMessage('í¬ì…˜ì´ ì—†ìŠµë‹ˆë‹¤!');
            }
            
            updateUI();
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            document.getElementById('playerLevel').textContent = player.level;
            document.getElementById('playerGold').textContent = player.gold;
            
            // HP ë°”
            const hpPercent = (player.hp / player.maxHp) * 100;
            document.getElementById('hpBar').style.width = hpPercent + '%';
            document.getElementById('hpText').textContent = `HP: ${player.hp}/${player.maxHp}`;
            
            // MP ë°”
            const mpPercent = (player.mp / player.maxMp) * 100;
            document.getElementById('mpBar').style.width = mpPercent + '%';
            document.getElementById('mpText').textContent = `MP: ${player.mp}/${player.maxMp}`;
            
            // EXP ë°”
            const expPercent = (player.exp / player.expToNext) * 100;
            document.getElementById('expBar').style.width = expPercent + '%';
            document.getElementById('expText').textContent = `EXP: ${player.exp}/${player.expToNext}`;
            
            // ì¸ë²¤í† ë¦¬
            updateInventory();
        }

        // ì  UI ì—…ë°ì´íŠ¸
        function updateEnemyUI() {
            if (!currentEnemy) return;
            
            const hpPercent = (currentEnemy.hp / currentEnemy.maxHp) * 100;
            document.getElementById('enemyHpBar').style.width = hpPercent + '%';
            document.getElementById('enemyHpText').textContent = `HP: ${currentEnemy.hp}/${currentEnemy.maxHp}`;
        }

        // ì¸ë²¤í† ë¦¬ ì—…ë°ì´íŠ¸
        function updateInventory() {
            const inventoryDiv = document.getElementById('inventorySlots');
            inventoryDiv.innerHTML = '';
            
            // ì²´ë ¥ í¬ì…˜
            for (let i = 0; i < player.inventory.hpPotions; i++) {
                const slot = document.createElement('div');
                slot.className = 'item-slot';
                slot.textContent = 'ğŸ§ª';
                slot.title = 'ì²´ë ¥ í¬ì…˜';
                inventoryDiv.appendChild(slot);
            }
            
            // ë§ˆë‚˜ í¬ì…˜
            for (let i = 0; i < player.inventory.mpPotions; i++) {
                const slot = document.createElement('div');
                slot.className = 'item-slot';
                slot.textContent = 'ğŸ’™';
                slot.title = 'ë§ˆë‚˜ í¬ì…˜';
                inventoryDiv.appendChild(slot);
            }
            
            // ë¹ˆ ìŠ¬ë¡¯
            const totalSlots = 12;
            const usedSlots = player.inventory.hpPotions + player.inventory.mpPotions;
            for (let i = usedSlots; i < totalSlots; i++) {
                const slot = document.createElement('div');
                slot.className = 'item-slot';
                inventoryDiv.appendChild(slot);
            }
        }

        // ë©”ì‹œì§€ ì¶”ê°€
        function addMessage(message) {
            const messageLog = document.getElementById('messageLog');
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messageLog.appendChild(messageDiv);
            messageLog.scrollTop = messageLog.scrollHeight;
            
            // ë©”ì‹œì§€ê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
            if (messageLog.children.length > 20) {
                messageLog.removeChild(messageLog.firstChild);
            }
        }

        // ê²Œì„ ì˜¤ë²„
        function gameOver() {
            gameRunning = false;
            addMessage('ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.');
        }

        // ê²Œì„ ë¦¬ì…‹
        function resetGame() {
            // í”Œë ˆì´ì–´ ì´ˆê¸°í™”
            player.x = 5;
            player.y = 5;
            player.level = 1;
            player.hp = 100;
            player.maxHp = 100;
            player.mp = 50;
            player.maxMp = 50;
            player.exp = 0;
            player.expToNext = 100;
            player.gold = 0;
            player.attack = 20;
            player.defense = 10;
            player.inventory = {
                hpPotions: 3,
                mpPotions: 2,
                keys: 0,
                treasures: 0
            };
            
            // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
            gameRunning = true;
            inBattle = false;
            currentEnemy = null;
            
            // UI ì´ˆê¸°í™”
            document.getElementById('battleUI').style.display = 'none';
            document.getElementById('messageLog').innerHTML = '<div>ìƒˆë¡œìš´ ëª¨í—˜ì´ ì‹œì‘ë©ë‹ˆë‹¤!</div>';
            
            updateUI();
            draw();
        }

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            
            switch(e.code) {
                case 'KeyW':
                case 'ArrowUp':
                    e.preventDefault();
                    movePlayer(0, -1);
                    break;
                case 'KeyS':
                case 'ArrowDown':
                    e.preventDefault();
                    movePlayer(0, 1);
                    break;
                case 'KeyA':
                case 'ArrowLeft':
                    e.preventDefault();
                    movePlayer(-1, 0);
                    break;
                case 'KeyD':
                case 'ArrowRight':
                    e.preventDefault();
                    movePlayer(1, 0);
                    break;
                case 'KeyH':
                    e.preventDefault();
                    usePotion('hp');
                    break;
                case 'KeyM':
                    e.preventDefault();
                    usePotion('mp');
                    break;
            }
        });

        // ê²Œì„ ì‹œì‘
        updateUI();
        draw();
        
        console.log('ë¯¸ë‹ˆ RPG ê²Œì„ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
    </script>
</body>
</html>